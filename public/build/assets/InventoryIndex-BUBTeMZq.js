import{r,K as le,m as oe,j as e,L as ie,S as F,a as ne}from"./app-CDPwVV6Y.js";import me from"./DynamicTable-C_SQJSlc.js";import{u as ce}from"./useAppUrl-BIsbUUVL.js";import{S as de,H as ue}from"./AdminLayout-BW3ywimG.js";import pe from"./ActionMenu-CazUS606.js";import xe from"./DynamicTableControls-CcWMFg7f.js";import{I as ge}from"./input-DTbtaxsV.js";import{B as y}from"./button-B_aprJyo.js";import be from"./FillterToggle-cYp57TD0.js";import{I as x}from"./InputField-D_ZI8EKx.js";import{I as m}from"./InputError-CsvCol3W.js";import{D as ye}from"./DropdownInputField-BmM-TOT_.js";import{I as he,a as ve,b as je}from"./index-D4O4cOmu.js";import fe from"./SidebarModal-CSWrtQJc.js";import{t as c,T as _e}from"./index-CH7DWExs.js";import{S as Ne}from"./SelectField-DIeNwIQe.js";import Se from"./DeleteConfirmationModal-DcMwm5QA.js";import we from"./BreadcrumbsHeader-BOSIhs5m.js";import{S as Ce}from"./search-BLeXCASV.js";import{L as Ie}from"./list-plus-D4__nvo2.js";import{R as ke}from"./rotate-ccw-D-jj88si.js";import{S as De}from"./square-pen-7JDEATcf.js";import{T as Ee}from"./trash-2-DGe7ZjJ3.js";import"./createLucideIcon-B4SoG9zf.js";import"./sidebar-BqlEtGlg.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./tooltip-10O7WS77.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./chevron-right-DYtVQaAj.js";import"./file-text-DhLfxzDZ.js";import"./users-round-BK2vts8v.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./ellipsis-pjh7Fz_j.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./constants-DHCt9dPc.js";import"./iconBase-DNpEM3Pe.js";import"./breadcrumb-DsnADmME.js";const wt=({inventory_items:I,categories:B,units:Oe,queryParams:l})=>{const L=[{label:"Barangay Resources",showOnMobile:!1},{label:"Inventories",showOnMobile:!0}],$=ce();l=l||{};const[U,h]=r.useState(!1),[H,v]=r.useState(""),[d,k]=r.useState(null),[D,V]=r.useState(l.name??""),[q,j]=r.useState(!1),[E,z]=r.useState(null),o=le().props,f=(o==null?void 0:o.success)??null,_=(o==null?void 0:o.error)??null,N=[{key:"id",label:"ID"},{key:"item_name",label:"Item"},{key:"item_category",label:"Category"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"status",label:"Status"},{key:"received_date",label:"Date Recieved"},{key:"supplier",label:"Supplier"},{key:"actions",label:"Actions"}],K=N.map(t=>t.key),[g,Q]=r.useState(()=>{const t=localStorage.getItem("inventory_visible_columns");return t?JSON.parse(t):K});r.useEffect(()=>{localStorage.setItem("inventory_visible_columns",JSON.stringify(g))},[g]);const S=Object.entries(l||{}).some(([t,s])=>["inventory_status","item_category","date_recieved"].includes(t)&&s&&s!=="");r.useEffect(()=>{S&&O(!0)},[S]);const[w,O]=r.useState(S),G=t=>{t.preventDefault(),C("name",D)},C=(t,s)=>{s&&s.trim()!==""?l[t]=s:delete l[t],l.page&&delete l.page,F.get(route("inventory.index",l))},J=(t,s)=>{s.key==="Enter"&&C(t,s.target.value)},W={id:t=>t.id,item_name:t=>e.jsx("span",{className:"font-medium text-gray-900",children:t.item_name||"—"}),item_category:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.item_category||"—"}),quantity:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.quantity??"—"}),year_established:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.year_established||"—"}),unit:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.unit||"—"}),status:t=>{const s={available:"bg-green-100 text-green-800",low_stock:"bg-yellow-100 text-yellow-800",out_of_stock:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${s[t.status]||"bg-gray-100 text-gray-800"}`,children:t.status||"—"})},received_date:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.received_date?new Date(t.received_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"—"}),supplier:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.supplier||"—"}),actions:t=>e.jsx(pe,{actions:[{label:"Edit",icon:e.jsx(De,{className:"w-4 h-4 text-green-500"}),onClick:()=>te(t.id)},{label:"Delete",icon:e.jsx(Ee,{className:"w-4 h-4 text-red-600"}),onClick:()=>ae(t.id)}]})},X=()=>{v("add"),h(!0)},{data:u,setData:b,post:M,errors:i,reset:A,clearErrors:Y}=oe({inventory_items:[[]],_method:void 0,item_id:null}),Z=()=>{b("inventory_items",[...u.inventory_items||[],{}])},P=t=>{const s=[...u.inventory_items||[]];s.splice(t,1),b("inventory_items",s),c.warning("Item removed.",{duration:2e3})},R=()=>{h(!1),v(""),k(null),A(),Y()},n=(t,s,a)=>{b(T=>{const p=[...T.inventory_items];return p[s]||(p[s]={}),p[s]={...p[s],[a]:t},{...T,inventory_items:p}})},ee=t=>{t.preventDefault(),M(route("inventory.store"),{onError:s=>{console.error("Validation Errors:",s);const a=Object.values(s).join("<br />");c.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}})},te=async t=>{v("edit");try{const a=(await ne.get(`${$}/inventory/details/${t}`)).data.item;k(a),b({inventory_items:[{item_name:a.item_name||"",item_category:a.item_category||"",quantity:a.quantity||"",unit:a.unit||"",received_date:a.received_date||"",supplier:a.supplier||"",status:a.status||""}],_method:"PUT",item_id:a.id}),h(!0)}catch(s){console.error("Error fetching inventory details:",s)}},se=t=>{t.preventDefault(),M(route("inventory.update",u.item_id),{onError:s=>{const a=Object.values(s).join("<br />");c.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}})},ae=t=>{z(t),j(!0)},re=()=>{F.delete(route("inventory.destroy",E),{onError:t=>{console.error("Validation Errors:",t);const s=Object.values(t).join("<br />");c.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})}}),j(!1)};return r.useEffect(()=>{f&&(R(),c.success(f,{description:"Operation successful!",duration:3e3,closeButton:!0})),o.success=null},[f]),r.useEffect(()=>{_&&c.error(_,{description:"Operation failed!",duration:3e3,closeButton:!0}),o.error=null},[_]),e.jsxs(de,{children:[e.jsx(ie,{title:"Barangay Infrastructure"}),e.jsx(we,{breadcrumbs:L}),e.jsx(_e,{richColors:!0}),e.jsxs("div",{className:"pt-4 mb-10",children:[e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(ue,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Barangay Inventory Overview"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review, filter, and manage barangay inventory items efficiently. Monitor stock levels, categories, and units with ease."})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(xe,{allColumns:N,visibleColumns:g,setVisibleColumns:Q,showFilters:w,toggleShowFilters:()=>O(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:G,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(ge,{type:"text",placeholder:"Search Inventory Items",value:D,onChange:t=>V(t.target.value),onKeyDown:t=>J("name",t.target.value),className:"ml-4"}),e.jsx(y,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Ce,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(y,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:X,children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add an Institution"})]})]})]}),w&&e.jsx(be,{queryParams:l,searchFieldName:C,visibleFilters:["inventory_status","item_category","date_recieved"],inventory_items:I,clearRouteName:"inventory.index",clearRouteParams:{},showFilters:w,types:B}),e.jsx(me,{passedData:I,queryParams:l,allColumns:N,columnRenderers:W,visibleColumns:g,showTotal:!0})]})]})}),e.jsx(fe,{isOpen:U,onClose:()=>{R()},title:H=="add"?"Add Item/s":"Edit Item",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:d?se:ee,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Inventory"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about the barangay’s inventory items."}),Array.isArray(u.inventory_items)&&u.inventory_items.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{label:"Item Name",name:"item_name",value:t.item_name||"",onChange:a=>n(a.target.value,s,"item_name"),placeholder:"e.g. Rice, Medicine, Generator"}),e.jsx(m,{message:i[`inventory_items.${s}.item_name`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(ye,{label:"Category",name:"item_category",value:t.item_category||"",onChange:a=>n(a.target.value,s,"item_category"),placeholder:"Select category",items:[{label:"Food",value:"food"},{label:"Medicine",value:"medicine"},{label:"Equipment",value:"equipment"},{label:"Relief Goods",value:"relief_goods"},{label:"Other",value:"other"}]}),e.jsx(m,{message:i[`inventory_items.${s}.item_category`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{label:"Quantity",name:"quantity",type:"number",value:t.quantity||"",onChange:a=>n(a.target.value,s,"quantity"),placeholder:"Enter quantity"}),e.jsx(m,{message:i[`inventory_items.${s}.quantity`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{label:"Unit",name:"unit",value:t.unit||"",onChange:a=>n(a.target.value,s,"unit"),placeholder:"e.g. kg, pcs, box"}),e.jsx(m,{message:i[`inventory_items.${s}.unit`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Ne,{label:"Status",name:"status",value:t.status||"",onChange:a=>n(a.target.value,s,"status"),items:[{label:"Available",value:"available"},{label:"Low Stock",value:"low_stock"},{label:"Out of Stock",value:"out_of_stock"}]}),e.jsx(m,{message:i[`inventory_items.${s}.status`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{label:"Date Received",name:"received_date",type:"date",value:t.received_date||"",onChange:a=>n(a.target.value,s,"received_date")}),e.jsx(m,{message:i[`inventory_items.${s}.received_date`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{label:"Supplier",name:"supplier",value:t.supplier||"",onChange:a=>n(a.target.value,s,"supplier"),placeholder:"e.g. Local Distributor, DOH"}),e.jsx(m,{message:i[`inventory_items.${s}.supplier`],className:"mt-1"})]})]}),d===null&&e.jsx("button",{type:"button",onClick:()=>P(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(he,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[d===null?e.jsxs("button",{type:"button",onClick:Z,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(ve,{className:"text-2xl"}),e.jsx("span",{children:"Add Item"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[d==null&&e.jsxs(y,{type:"button",onClick:()=>A(),children:[e.jsx(ke,{})," Reset"]}),e.jsxs(y,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[d?"Update":"Add"," ",e.jsx(je,{})]})]})]})]})}),e.jsx(Se,{isOpen:q,onClose:()=>{j(!1)},onConfirm:re,residentId:E})]})]})};export{wt as default};
