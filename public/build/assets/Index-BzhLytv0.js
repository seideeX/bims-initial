import{K as ee,r,m as te,j as t,L as se,a as ae,S as E}from"./app-CDPwVV6Y.js";import{S as re,d as le}from"./AdminLayout-BW3ywimG.js";import{B as T}from"./button-B_aprJyo.js";import ie from"./BreadcrumbsHeader-BOSIhs5m.js";import"./index-Dsz93ONd.js";import{B as oe,C as ne,i as ce}from"./constants-DHCt9dPc.js";import{u as ue}from"./useAppUrl-BIsbUUVL.js";import{t as f,T as de}from"./index-CH7DWExs.js";import me from"./DynamicTableControls-CcWMFg7f.js";import{I as pe}from"./input-DTbtaxsV.js";import xe from"./FillterToggle-cYp57TD0.js";import fe from"./DynamicTable-C_SQJSlc.js";import be from"./ActionMenu-CazUS606.js";import he from"./SidebarModal-CSWrtQJc.js";import ge from"./Request-B2bYwe_1.js";import{F as _e}from"./file-text-DhLfxzDZ.js";import{S as ve}from"./search-BLeXCASV.js";import{c as ye}from"./createLucideIcon-B4SoG9zf.js";import"./sidebar-BqlEtGlg.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-8Tef56KC.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./tooltip-10O7WS77.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./chevron-right-DYtVQaAj.js";import"./DeleteConfirmationModal-DcMwm5QA.js";import"./users-round-BK2vts8v.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./breadcrumb-DsnADmME.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./ellipsis-pjh7Fz_j.js";import"./InputField-D_ZI8EKx.js";import"./DropdownInputField-BmM-TOT_.js";import"./InputError-CsvCol3W.js";import"./stringFormat-Dx_XIxG1.js";import"./rotate-ccw-D-jj88si.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ne=ye("octagon-x",je);function ft({documents:b,residents:Se,certificates:k,queryParams:a=null}){const R=[{label:"Residents Information",showOnMobile:!1},{label:"Certificate Issuance",showOnMobile:!0}],l=ee().props,u=(l==null?void 0:l.success)??null,d=(l==null?void 0:l.error)??null;r.useEffect(()=>{u&&(I(),f.success(u,{description:"Operation successful!",duration:3e3,closeButton:!0})),l.success=null},[u]),r.useEffect(()=>{d&&f.error(d,{description:"Operation failed!",duration:3e3,closeButton:!0}),l.error=null},[d]);const F=ue(),O=["fullname","fullname_2","day","month","year","ctrl_no","civil_status","civil_status_2","purpose","purpose_2","purok","day_2","month_2","year_2","issued_on"],{data:o,setData:n,post:M,errors:D,setError:h,reset:g,clearErrors:_}=te({resident_id:null,resident_name:"",document_id:null,document_name:"",birthdate:null,age:null,civil_status:"",resident_image:"",purpose:"",placeholders:null,dynamicValues:[]}),B=[{label:"January",value:"1"},{label:"February",value:"2"},{label:"March",value:"3"},{label:"April",value:"4"},{label:"May",value:"5"},{label:"June",value:"6"},{label:"July",value:"7"},{label:"August",value:"8"},{label:"September",value:"9"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}],z=async e=>{const s=b.find(i=>i.id==e);if(s){n("document_name",s.name),n("document_id",s.id);try{const i=await ae.get(`${F}/document/fetchplaceholders/${e}`);n("placeholders",i.data.placeholders)}catch(i){console.error("Error fetching placeholders:",i)}}},v=b.map(e=>({label:e.name.replace(/\s+/g," ").trim(),value:e.id.toString()})),L=e=>{if(e.preventDefault(),_(),!o.document_id){h("document_id","Please select a certificate.");return}if(!o.purpose){h("purpose","Please provide the purpose.");return}M(route("resident.certificate.store"),o,{onError:s=>{console.error("Validation Errors:",s);const i=Object.values(s).flat();f.error("Validation Error",{description:t.jsx("ul",{className:"list-disc pl-5",children:i.map((W,Z)=>t.jsx("li",{children:W},Z))})})}})};a=a||{};const[y,V]=r.useState(a.name??""),q=e=>{e.preventDefault(),m("name",y)},m=(e,s)=>{s&&s.trim()!==""?a[e]=s:delete a[e],a.page&&delete a.page,E.get(route("resident_account.certificates",a))},U=(e,s)=>{if(s.key==="Enter")m(e,s.target.value);else return},[J,j]=r.useState(!1),[K,N]=r.useState(""),p=Object.entries(a||{}).some(([e,s])=>["certificate_type","request_status","issued_by","issued_at"].includes(e)&&s&&s!=="");r.useEffect(()=>{p&&w(!0)},[p]);const x=[{key:"id",label:"Issued ID"},{key:"certificate",label:"Certificate"},{key:"purpose",label:"Purpose"},{key:"request_status",label:"Request Status"},{key:"issued_by",label:"Issued By"},{key:"issued_at",label:"Issued At"},{key:"control_number",label:"Control Number"},{key:"actions",label:"Actions"}],[S,w]=r.useState(p),P=()=>{window.print()},[Q,we]=r.useState(!0),[C,X]=r.useState(!1),$=x.map(e=>e.key),[c,A]=r.useState(()=>{const e=localStorage.getItem("certificate_visible_columns");return e?JSON.parse(e):$});r.useEffect(()=>{localStorage.setItem("certificate_visible_columns",JSON.stringify(c))},[c]);const H={id:e=>t.jsx("span",{className:"text-xs text-gray-700",children:e.id}),certificate:e=>{var s;return t.jsx("span",{className:"text-xs text-indigo-700 font-medium",children:((s=e.document)==null?void 0:s.name)??"—"})},purpose:e=>t.jsx("span",{className:"text-xs text-gray-700",children:e.purpose??"—"}),request_status:e=>t.jsx("span",{className:`text-xs font-medium ${ce[e.request_status]}`,children:ne[e.request_status]??"—"}),issued_by:e=>{var s;return t.jsx("span",{className:"text-xs text-gray-700",children:oe[(s=e.issued_by)==null?void 0:s.position]??"—"})},issued_at:e=>t.jsx("span",{className:"text-xs text-gray-600",children:e.issued_at??"—"}),control_number:e=>t.jsx("span",{className:"text-xs text-gray-600",children:e.control_number??"—"}),actions:e=>t.jsx(be,{actions:[{label:"Cancel Request",icon:t.jsx(Ne,{className:"w-4 h-4 text-red-600"}),onClick:()=>Y(e.id)}]})},Y=e=>{E.delete(route("resident_account.certificate.destroy",e))},G=()=>{N("add"),j(!0)},I=()=>{j(!1),N(""),g(),_()};return t.jsxs(re,{children:[t.jsx(se,{title:"Certificate Issuance"}),t.jsx(de,{richColors:!0}),t.jsxs("div",{children:[t.jsx(ie,{breadcrumbs:R}),t.jsxs("div",{className:"p-2 md:p-4",children:[t.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:t.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-xl shadow-sm",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:t.jsx(_e,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"My Certificates"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["View and request"," ",t.jsx("span",{className:"font-medium",children:"official certificates"})," ","from your barangay. You can check your records, request new certificates, or download available documents below."]})]})]})}),t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[t.jsx("div",{className:"flex items-start gap-2 flex-wrap",children:t.jsx(me,{allColumns:x,visibleColumns:c,setVisibleColumns:A,onPrint:P,showFilters:S,toggleShowFilters:()=>w(e=>!e)})}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[t.jsxs("form",{onSubmit:q,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[t.jsx(pe,{type:"text",placeholder:"Search Name",value:y,onChange:e=>V(e.target.value),onKeyDown:e=>U("name",e),className:"w-full"}),t.jsxs("div",{className:"relative group z-50",children:[t.jsx(T,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:t.jsx(ve,{})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),t.jsxs("div",{className:"relative group z-50",children:[t.jsx(T,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:G,children:t.jsx(le,{className:"w-4 h-4"})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Request Certificate"})]})]})]}),S&&t.jsx(xe,{queryParams:a,searchFieldName:m,visibleFilters:["certificate_type","request_status","issued_by","issued_at"],certificateTypes:v,showFilters:!0,months:B,clearRouteName:"resident_account.certificates",clearRouteParams:{}}),t.jsx(fe,{passedData:k,allColumns:x,columnRenderers:H,queryParams:a,is_paginated:Q,toggleShowAll:()=>X(!C),showAll:C,visibleColumns:c,setVisibleColumns:A})]})}),t.jsx(he,{isOpen:J,onClose:I,title:"Request a Certificate",children:K==="add"&&t.jsx(ge,{data:o,setData:n,errors:D,documentsList:v,handleDocumentChange:z,handleRequest:L,reset:g,defaultPlaceholders:O})})]})]})]})}export{ft as default};
