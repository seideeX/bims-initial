import{K as ye,r as i,m as fe,j as e,L as _e,S as B,a as V}from"./app-CDPwVV6Y.js";import ve from"./ActionMenu-CazUS606.js";import je from"./BreadcrumbsHeader-BOSIhs5m.js";import Ne from"./DynamicTable-C_SQJSlc.js";import{B as f}from"./button-B_aprJyo.js";import{I as we}from"./input-DTbtaxsV.js";import{S as ke}from"./AdminLayout-BW3ywimG.js";import{I as Se,a as Ce,b as Oe}from"./index-D4O4cOmu.js";import Ee from"./FillterToggle-cYp57TD0.js";import Re from"./DynamicTableControls-CcWMFg7f.js";import $e from"./PersonDetailContent-ghJKAROu.js";import Te from"./SidebarModal-CSWrtQJc.js";import{u as De}from"./useAppUrl-BIsbUUVL.js";import{I as Ae}from"./InputLabel-C3y8TkvV.js";import{I as _}from"./InputField-D_ZI8EKx.js";import{I as n}from"./InputError-CsvCol3W.js";import{R as z}from"./RadioGroup-K1vYBuUY.js";import{D as W}from"./DropdownInputField-BmM-TOT_.js";import{t as C,T as Fe}from"./index-CH7DWExs.js";import{U as Me,W as Le,h as Ye}from"./constants-DHCt9dPc.js";import{u as Ue}from"./handleResidentChange-yybasKmi.js";import{S as x}from"./SelectField-DIeNwIQe.js";import{Y as P}from"./YearDropdown-Cu5CjLYl.js";import Ie from"./DeleteConfirmationModal-DcMwm5QA.js";import{E as X}from"./ExportButton-CO89vrVN.js";import{t as Be}from"./stringFormat-Dx_XIxG1.js";import{B as Ve}from"./briefcase-CSPZpL4H.js";import{S as ze}from"./search-BLeXCASV.js";import{L as We}from"./list-plus-D4__nvo2.js";import{R as Pe}from"./rotate-ccw-D-jj88si.js";import{E as Xe}from"./eye-CTOC_KFU.js";import{S as He}from"./square-pen-7JDEATcf.js";import{T as Ke}from"./trash-2-DGe7ZjJ3.js";import"./dropdown-menu-DFrz86N0.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./check-BsJSkZwI.js";import"./createLucideIcon-B4SoG9zf.js";import"./chevron-right-DYtVQaAj.js";import"./tooltip-10O7WS77.js";import"./ellipsis-pjh7Fz_j.js";import"./breadcrumb-DsnADmME.js";import"./sidebar-BqlEtGlg.js";import"./x-rg4AgZHH.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./file-text-DhLfxzDZ.js";import"./users-round-BK2vts8v.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./iconBase-DNpEM3Pe.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./index-BDJITxkD.js";import"./index-BvB2ajn5.js";import"./file-output-BVnTKX-L.js";function ta({occupations:O,puroks:H,queryParams:o=null,residents:E=[],occupationTypes:K=[]}){const G=[{label:"Residents Information",showOnMobile:!1},{label:"Residents Occupation",showOnMobile:!0}];o=o||{};const R=De(),d=ye().props,v=(d==null?void 0:d.success)??null,j=(d==null?void 0:d.error)??null,[$,J]=i.useState(o.name??""),Q=t=>{t.preventDefault(),N("name",$)},N=(t,a)=>{a&&a.trim()!==""?o[t]=a:delete o[t],o.page&&delete o.page,B.get(route("occupation.index",o))},Z=(t,a)=>{if(a.key==="Enter")N(t,a.target.value);else return},[q,b]=i.useState(!1),[h,g]=i.useState(""),[c,T]=i.useState(null),[ee,w]=i.useState(!1),[D,te]=i.useState(null),k=Object.entries(o||{}).some(([t,a])=>["purok","employment_type","work_arrangement","occupation_status","is_ofw","year_started","year_ended","latest_occupation"].includes(t)&&a&&a!=="");i.useEffect(()=>{k&&F(!0)},[k]);const S=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"occupation",label:"Occupation / Livelihood"},{key:"employment_type",label:"Employment Type"},{key:"work_arrangement",label:"Work Arrangement"},{key:"occupation_status",label:"Status"},{key:"started_at",label:"Year Started"},{key:"ended_at",label:"Year Ended"},{key:"is_ofw",label:"Is OFW?"},{key:"is_main",label:"Is Main Livelihood?"},{key:"purok_number",label:"Purok"},{key:"actions",label:"Actions"}],[A,F]=i.useState(k),[M,L]=i.useState(null),ae=S.map(t=>t.key),[y,se]=i.useState(()=>{const t=localStorage.getItem("occupation_visible_columns");return t?JSON.parse(t):ae});i.useEffect(()=>{localStorage.setItem("occupation_visible_columns",JSON.stringify(y))},[y]);const le={id:t=>t.id??"â€”",name:t=>{const{firstname:a,middlename:s,lastname:p,suffix:ge}=t.resident??{};return Be(`${a??""} ${s??""} ${p??""} ${ge??""}`).trim()||e.jsx("span",{className:"text-gray-400 italic",children:"Not specified"})},occupation:t=>e.jsx("span",{className:"text-xs text-gray-800",children:t.occupation??e.jsx("span",{className:"text-gray-400 italic",children:"Not specified"})}),employment_type:t=>e.jsx("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:Ye[t.employment_type]??"Not specified"}),work_arrangement:t=>e.jsx("span",{className:"bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:Le[t.work_arrangement]??"Not specified"}),occupation_status:t=>{const a=t.occupation_status??null,s=a==="active"?"bg-green-100 text-green-800":a==="inactive"?"bg-red-100 text-red-800":a==="retired"?"bg-gray-100 text-gray-700":a==="ended"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-600";return e.jsx("span",{className:`${s} px-2 py-0.5 rounded-md text-xs font-medium capitalize`,children:a?Me[a]||a.replaceAll("_"," "):"Not specified"})},started_at:t=>e.jsx("span",{className:"text-xs text-gray-700",children:t.started_at??e.jsx("span",{className:"text-gray-400 italic",children:"Not specified"})}),ended_at:t=>e.jsx("span",{className:"text-xs text-gray-700",children:t.ended_at??e.jsx("span",{className:"text-gray-400 italic",children:"Not specified"})}),is_ofw:t=>e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium ${t.is_ofw?"bg-green-100 text-green-800":"bg-gray-100 text-gray-700"}`,children:t.is_ofw?"Yes":"No"}),is_main:t=>e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium ${t.is_main_livelihood?"bg-green-100 text-green-800":"bg-gray-100 text-gray-700"}`,children:t.is_main_livelihood?"Yes":"No"}),purok_number:t=>{var a;return e.jsx("span",{className:"text-xs text-gray-800",children:((a=t.resident)==null?void 0:a.purok_number)??e.jsx("span",{className:"text-gray-400 italic",children:"Not specified"})})},actions:t=>e.jsx(ve,{actions:[{label:"View",icon:e.jsx(Xe,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>{var a;return oe((a=t.resident)==null?void 0:a.id)}},{label:"Edit",icon:e.jsx(He,{className:"w-4 h-4 text-green-500"}),onClick:()=>ue(t.id)},{label:"Delete",icon:e.jsx(Ke,{className:"w-4 h-4 text-red-600"}),onClick:()=>be(t.id)}]})},oe=async t=>{g("view"),L(null);try{const a=await V.get(`${R}/resident/showresident/${t}`);L(a.data.resident)}catch(a){console.error("Error fetching placeholders:",a)}b(!0)},ie=E.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),{data:r,setData:u,post:Y,errors:l,reset:U,clearErrors:ne}=fe({resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,employment_status:null,occupations:[[]],_method:void 0,occupation_id:null}),re=Ue(E,u),me=()=>{u("occupations",[...r.occupations||[],{}])},de=t=>{const a=[...r.occupations||[]];a.splice(t,1),u("occupations",a),C.warning("Occupation removed.",{duration:2e3})},m=(t,a,s)=>{const p=[...r.occupations||[]];p[a]={...p[a],[s]:t.target.value},u("occupations",p)},ce=()=>{g("add"),b(!0)},ue=async t=>{g("add");try{const s=(await V.get(`${R}/occupation/details/${t}`)).data.occupation;console.log(s),T(s),u({resident_id:s.resident.id,resident_name:`${s.resident.firstname} ${s.resident.middlename??""} ${s.resident.lastname}`,resident_image:s.resident.image??null,birthdate:s.resident.birthdate??null,purok_number:s.resident.purok_number??null,employment_status:s.resident.employment_status,occupations:[{employer:s.employer||"",occupation:s.occupation||"",occupation_status:s.occupation_status||"",employment_type:s.employment_type||"",is_ofw:s.is_ofw?s.is_ofw.toString():"0",is_main_livelihood:s.is_main_livelihood?s.is_main_livelihood.toString():"0",work_arrangement:s.work_arrangement||"",income:s.monthly_income||0,income_frequency:"monthly",started_at:s.started_at||"",ended_at:s.ended_at||""}],_method:"PUT",occupation_id:s.id}),b(!0)}catch(a){console.error("Error fetching occupation details:",a)}},I=()=>{b(!1),g(""),T(null),U(),ne()},pe=t=>{t.preventDefault(),Y(route("occupation.store"),{onError:()=>{console.error("Validation Errors:",l)}})},xe=t=>{t.preventDefault(),Y(route("occupation.update",r.occupation_id),{onError:()=>{console.error("Validation Errors:",l)}})},be=t=>{te(t),w(!0)},he=()=>{B.delete(route("occupation.destroy",D)),w(!1)};return i.useEffect(()=>{v&&(I(),C.success(v,{description:"Operation successful!",duration:3e3})),d.success=null},[v]),i.useEffect(()=>{j&&C.error(j,{description:"Operation failed!",duration:3e3,closeButton:!0}),d.error=null},[j]),e.jsxs(ke,{children:[e.jsx(_e,{title:"Residents Occupations"}),e.jsx(je,{breadcrumbs:G}),e.jsx(Fe,{richColors:!0}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full",children:e.jsx(Ve,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Occupation Records"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Manage and track resident occupations, including employment type, work arrangement, and status. Use the tools below to",e.jsxs("span",{className:"font-medium",children:[" ","search, filter, and export"]})," ","records for reporting and labor insights."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx(Re,{allColumns:S,visibleColumns:y,setVisibleColumns:se,showFilters:A,toggleShowFilters:()=>F(t=>!t)}),e.jsx(X,{url:"report/export-occupations-excel",queryParams:o,label:"Export Resident Occupations as XLSX"}),e.jsx(X,{url:"report/export-occupations-pdf",queryParams:o,label:"Export Education Histories as PDF",type:"pdf",totalRecords:O.total})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:Q,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(we,{type:"text",placeholder:"Search Name",value:$,onChange:t=>J(t.target.value),onKeyDown:t=>Z("name",t),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(f,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(ze,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(f,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:ce,children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add an Occupation"})]})]})]}),A&&e.jsx(Ee,{queryParams:o,searchFieldName:N,visibleFilters:["purok","employment_type","work_arrangement","occupation_status","is_ofw","year_started","year_ended","latest_occupation"],puroks:H,showFilters:!0,clearRouteName:"occupation.index",clearRouteParams:{}}),e.jsx(Ne,{passedData:O,allColumns:S,columnRenderers:le,queryParams:o,visibleColumns:y,showTotal:!0})]})})}),e.jsxs(Te,{isOpen:q,onClose:()=>{I()},title:h==="add"&&c?"Edit Occupation":h==="add"?"Add Occupation":"View Resident",children:[h==="add"&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:c?xe:pe,children:[e.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-8",children:"Resident's Info"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-2 md:gap-x-4 mb-5 w-full",children:[e.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Ae,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:r.resident_image?`/storage/${r.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(W,{label:"Full Name",name:"resident_name",value:r.resident_name||"",placeholder:"Select a resident",onChange:t=>re(t),items:ie,readOnly:c}),e.jsx(n,{message:l.resident_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(_,{label:"Birthdate",name:"birthdate",value:r.birthdate||"",readOnly:!0})}),e.jsx("div",{children:e.jsx(_,{label:"Purok Number",name:"purok_number",value:r.purok_number,readOnly:!0})})]}),e.jsxs("div",{className:"w-[200px] mb-4",children:[e.jsx(x,{label:"Current Employment Status",name:"employment_status",value:r.employment_status||"",onChange:t=>u("employment_status",t.target.value),items:[{label:"Employed",value:"employed"},{label:"Unemployed",value:"unemployed"},{label:"Underemployed",value:"under_employed"},{label:"Retired",value:"retired"},{label:"Student",value:"student"}]}),e.jsx(n,{message:l.employment_status,className:"mt-2"})]})]})]}),Array.isArray(r.occupations)&&r.occupations.map((t,a)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{label:"Occupation",name:"occupation",value:t.occupation||"",onChange:s=>m(s,a,"occupation"),placeholder:"Select or Enter Occupation",items:K,disabled:t.employment_status==="unemployed"}),e.jsx(n,{message:l[`occupations.${a}.occupation`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Employment Type",name:"employment_type",value:t.employment_type||"",onChange:s=>m(s,a,"employment_type"),items:[{label:"Full-time",value:"full_time"},{label:"Part-time",value:"part_time"},{label:"Seasonal",value:"seasonal"},{label:"Contractual",value:"contractual"},{label:"Self-employed",value:"self_employed"}]}),e.jsx(n,{message:l[`occupations.${a}.employment_type`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Occupation Status",name:"occupation_status",value:t.occupation_status||"",onChange:s=>m(s,a,"occupation_status"),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Ended",value:"ended"},{label:"Retired",value:"retired"},{label:"Terminated",value:"terminated"},{label:"Resigned",value:"resigned"}]}),e.jsx(n,{message:l[`occupations.${a}.occupation_status`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Work Arrangement",name:"work_arrangement",items:[{label:"Remote",value:"remote"},{label:"On-site",value:"on_site"},{label:"Hybrid",value:"hybrid"}],value:t.work_arrangement||"",onChange:s=>m(s,a,"work_arrangement")}),e.jsx(n,{message:l[`occupations.${a}.work_arrangement`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(_,{label:"Employer name",name:"employer",type:"text",value:t.employer||"",onChange:s=>m(s,a,"employer"),placeholder:"Enter employer name"}),e.jsx(n,{message:l[`occupations.${a}.employer`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(P,{label:"Year Started",name:"started_at",value:t.started_at||"",onChange:s=>m(s,a,"started_at")}),e.jsx(n,{message:l[`occupations.${a}.started_at`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(P,{label:"Year Ended",name:"ended_at",value:t.ended_at||"",onChange:s=>m(s,a,"ended_at"),disabled:t.occupation_status==="active"}),e.jsx(n,{message:l[`occupations.${a}.ended_at`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(_,{type:"number",label:"Income",name:"income",value:t.income||"",onChange:s=>m(s,a,"income"),placeholder:"Enter Income"}),e.jsx(n,{message:l[`occupations.${a}.income`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Income Frequency",name:"income_frequency",value:t.income_frequency||"",onChange:s=>m(s,a,"income_frequency"),items:[{label:"Daily",value:"daily"},{label:"Bi-weekly",value:"bi_weekly"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Annually",value:"annually"}]}),e.jsx(n,{message:l[`occupations.${a}.income_frequency`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(z,{label:"Overseas Filipino Worker",name:"is_ofw",selectedValue:t.is_ofw||"",options:[{label:"Yes",value:1},{label:"No",value:0}],onChange:s=>m(s,a,"is_ofw")}),e.jsx(n,{message:l[`occupations.${a}.is_ofw`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(z,{label:"Is Main Livelihood",name:"is_main_livelihood",selectedValue:t.is_main_livelihood||"",options:[{label:"Yes",value:1},{label:"No",value:0}],onChange:s=>m(s,a,"is_main_livelihood")}),e.jsx(n,{message:l[`occupations.${a}.is_main_livelihood`],className:"mt-2"})]})]}),c===null&&e.jsx("button",{type:"button",onClick:()=>de(a),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(Se,{className:"text-2xl"})})]},a)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[c===null?e.jsxs("button",{type:"button",onClick:me,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Ce,{className:"text-2xl"}),e.jsx("span",{children:"Add Occupation"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[c==null&&e.jsxs(f,{type:"button",onClick:()=>U(),children:[e.jsx(Pe,{})," Reset"]}),e.jsxs(f,{className:"bg-blue-700 hover:bg-blue-400 ",type:"submit",children:[c?"Update":"Add"," ",e.jsx(Oe,{})]})]})]})]})}),h==="view"&&M?e.jsx($e,{person:M}):null]}),e.jsx(Ie,{isOpen:ee,onClose:()=>{w(!1)},onConfirm:he,residentId:D})]})}export{ta as default};
