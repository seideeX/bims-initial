import{r as s,K as ne,m as oe,j as e,L as ue,S as A,a as ce}from"./app-CDPwVV6Y.js";import{u as me}from"./useAppUrl-BIsbUUVL.js";import{S as de,H as pe}from"./AdminLayout-BW3ywimG.js";import fe from"./ActionMenu-CazUS606.js";import{I as ge}from"./InputField-D_ZI8EKx.js";import{B as b}from"./button-B_aprJyo.js";import{I as be}from"./input-DTbtaxsV.js";import xe from"./SidebarModal-CSWrtQJc.js";import{I as he,a as ye,b as ve}from"./index-D4O4cOmu.js";import{D as B}from"./DropdownInputField-BmM-TOT_.js";import{t as n,T as je}from"./index-CH7DWExs.js";import{I as _e}from"./InputLabel-C3y8TkvV.js";import Ce from"./DeleteConfirmationModal-DcMwm5QA.js";import Ne from"./BreadcrumbsHeader-BOSIhs5m.js";import Se from"./FillterToggle-cYp57TD0.js";import Ie from"./DynamicTableControls-CcWMFg7f.js";import we from"./DynamicTable-C_SQJSlc.js";import{I as x}from"./InputError-CsvCol3W.js";import{S as De}from"./search-BLeXCASV.js";import{L as Ee}from"./list-plus-D4__nvo2.js";import{R as Me}from"./rotate-ccw-D-jj88si.js";import{S as Oe}from"./square-pen-7JDEATcf.js";import{T as Fe}from"./trash-2-DGe7ZjJ3.js";import"./sidebar-BqlEtGlg.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./createLucideIcon-B4SoG9zf.js";import"./tooltip-10O7WS77.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./chevron-right-DYtVQaAj.js";import"./file-text-DhLfxzDZ.js";import"./users-round-BK2vts8v.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./ellipsis-pjh7Fz_j.js";import"./iconBase-DNpEM3Pe.js";import"./breadcrumb-DsnADmME.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./constants-DHCt9dPc.js";function It({infrastructure:R,types:T,categories:H,queryParams:l}){const L=[{label:"Barangay Resources",showOnMobile:!1},{label:"Infrastructures",showOnMobile:!0}],U=me();l=l||{};const[P,h]=s.useState(!1),[V,y]=s.useState(""),[o,w]=s.useState(null),[D,$]=s.useState(l.name??""),[Q,v]=s.useState(!1),[E,z]=s.useState(null),i=ne().props,j=(i==null?void 0:i.success)??null,_=(i==null?void 0:i.error)??null,C=[{key:"id",label:"ID"},{key:"image",label:"Image"},{key:"infrastructure_type",label:"Type"},{key:"infrastructure_category",label:"Category"},{key:"quantity",label:"Quantity"},{key:"created_at",label:"Created At"},{key:"updated_at",label:"Updated At"},{key:"actions",label:"Actions"}],K=C.map(t=>t.key),[d,G]=s.useState(()=>{const t=localStorage.getItem("infrastructures_visible_columns");return t?JSON.parse(t):K});s.useEffect(()=>{localStorage.setItem("infrastructures_visible_columns",JSON.stringify(d))},[d]);const N=Object.entries(l||{}).some(([t,r])=>["infra_type","infra_category","created_at","updated_at"].includes(t)&&r&&r!=="");s.useEffect(()=>{N&&M(!0)},[N]);const[S,M]=s.useState(N),J=t=>{t.preventDefault(),I("name",D)},I=(t,r)=>{r&&r.trim()!==""?l[t]=r:delete l[t],l.page&&delete l.page,A.get(route("barangay_infrastructure.index",l))},W=(t,r)=>{r.key==="Enter"&&I(t,r.target.value)},q={id:t=>t.id,image:t=>e.jsx("img",{src:t.infrastructure_image?`/storage/${t.infrastructure_image}`:"/images/default-avatar.jpg",onError:r=>{r.target.onerror=null,r.target.src="/images/default-avatar.jpg"},alt:"Resident",className:"w-20 h-20 min-w-20 min-h-20 object-cover rounded-sm border"}),infrastructure_type:t=>e.jsx("span",{className:"font-medium text-gray-900",children:t.infrastructure_type||"—"}),infrastructure_category:t=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:t.infrastructure_category||"—"}),quantity:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.quantity??"—"}),created_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),updated_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.updated_at?new Date(t.updated_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),actions:t=>e.jsx(fe,{actions:[{label:"Edit",icon:e.jsx(Oe,{className:"w-4 h-4 text-green-500"}),onClick:()=>ae(t.id)},{label:"Delete",icon:e.jsx(Fe,{className:"w-4 h-4 text-red-600"}),onClick:()=>le(t.id)}]})},X=()=>{y("add"),h(!0)},{data:u,setData:p,post:O,errors:f,reset:F,clearErrors:Y}=oe({infrastructures:[[]],_method:void 0,infrastructure_id:null}),Z=()=>{p("infrastructures",[...u.infrastructures||[],{}])},ee=t=>{const r=[...u.infrastructures||[]];r.splice(t,1),p("infrastructures",r),n.warning("Infrastructure removed.",{duration:2e3})},g=(t,r,a)=>{p(c=>{const m=[...c.infrastructures];return a==="infrastructure_image"&&t instanceof File?m[r]={...m[r],infrastructure_image:t,previewImage:URL.createObjectURL(t)}:m[r]={...m[r],[a]:t},{...c,infrastructures:m}})},k=()=>{h(!1),y(""),w(null),F(),Y()},te=[{label:"Evacuation Center",value:"Evacuation Center"},{label:"Flood Control",value:"Flood Control"},{label:"Rain Water Harvester (Communal)",value:"Rain Water Harvester (Communal)"},{label:"Barangay Disaster Operation Center",value:"Barangay Disaster Operation Center"},{label:"Public Comfort Room/Toilet",value:"Public Comfort Room/Toilet"},{label:"Community Garden",value:"Community Garden"},{label:"Barangay Health Center",value:"Barangay Health Center"},{label:"Hospital",value:"Hospital"},{label:"Maternity Clinic",value:"Maternity Clinic"},{label:"Child Clinic",value:"Child Clinic"},{label:"Private Medical Clinic",value:"Private Medical Clinic"},{label:"Barangay Drug Store",value:"Barangay Drug Store"},{label:"City/Municipal Public Drug Store",value:"City/Municipal Public Drug Store"},{label:"Private Drug Store",value:"Private Drug Store"},{label:"Quarantine/Isolation Facility",value:"Quarantine/Isolation Facility"},{label:"Child Development Center",value:"Child Development Center"},{label:"Preschool",value:"Preschool"},{label:"Elementary",value:"Elementary"},{label:"Secondary",value:"Secondary"},{label:"Vocational",value:"Vocational"},{label:"College/University",value:"College/University"},{label:"Islamic School",value:"Islamic School"},{label:"Rice Mill",value:"Rice Mill"},{label:"Corn Mill",value:"Corn Mill"},{label:"Feed Mill",value:"Feed Mill"},{label:"Agricultural Produce Market",value:"Agricultural Produce Market"}],re=t=>{t.preventDefault(),O(route("barangay_infrastructure.store"),{onError:r=>{console.error("Validation Errors:",r);const a=Object.values(r).join("<br />");n.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}})},ae=async t=>{y("edit");try{const a=(await ce.get(`${U}/barangay_infrastructure/details/${t}`)).data.infra;w(a),p({infrastructures:[{infrastructure_image:null,previewImage:a.infrastructure_image?`/storage/${a.infrastructure_image}`:null,infrastructure_type:a.infrastructure_type||"",infrastructure_category:a.infrastructure_category||"",quantity:a.quantity||""}],_method:"PUT",infrastructure_id:a.id}),h(!0)}catch(r){console.error("Error fetching infrastructure details:",r)}},se=t=>{t.preventDefault(),O(route("barangay_infrastructure.update",u.infrastructure_id),{onError:r=>{console.error("Validation Errors:",r);const a=Object.values(r).join("<br />");n.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}})},le=t=>{z(t),v(!0)},ie=()=>{A.delete(route("barangay_infrastructure.destroy",E),{onError:t=>{console.error("Validation Errors:",t);const r=Object.values(t).join("<br />");n.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:r}}),duration:3e3,closeButton:!0})}}),v(!1)};return s.useEffect(()=>{j&&(k(),n.success(j,{description:"Operation successful!",duration:3e3,closeButton:!0})),i.success=null},[j]),s.useEffect(()=>{_&&n.error(_,{description:"Operation failed!",duration:3e3,closeButton:!0}),i.error=null},[_]),e.jsxs(de,{children:[e.jsx(ue,{title:"Barangay Infrastructure"}),e.jsx(Ne,{breadcrumbs:L}),e.jsx(je,{richColors:!0}),e.jsxs("div",{className:"pt-4 mb-10",children:[e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(pe,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Barangay Infrastructure Overview"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review, filter, and manage existing barangay infrastructures efficiently."})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsxs("div",{className:"flex flex-wrap justify-between gap-2 mb-4",children:[e.jsx(Ie,{allColumns:C,visibleColumns:d,setVisibleColumns:G,showFilters:S,toggleShowFilters:()=>M(t=>!t)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("form",{onSubmit:J,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(be,{type:"text",placeholder:"Search infrastructure name",value:D,onChange:t=>$(t.target.value),onKeyDown:t=>W("name",t),className:"ml-4"}),e.jsx(b,{type:"submit",className:"border border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",variant:"outline",children:e.jsx(De,{})})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(b,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:X,children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add an Infrastructure"})]})]})]}),S&&e.jsx(Se,{queryParams:l,searchFieldName:I,visibleFilters:["infra_type","infra_category","created_at","updated_at"],categories:H,types:T,clearRouteName:"barangay_infrastructure.index",clearRouteParams:{},showFilters:S}),e.jsx(we,{queryParams:l,passedData:R,allColumns:C,columnRenderers:q,visibleColumns:d,showTotal:!0})]})]})}),e.jsx(xe,{isOpen:P,onClose:()=>{k()},title:V=="add"?"Add Infrastructure":"Edit Infrastructure",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:o?se:re,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Infrastructure Information"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about the existing facilities, utilities, and structures within the barangay."}),Array.isArray(u.infrastructures)&&u.infrastructures.map((t,r)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(_e,{htmlFor:`infrastructure_image_${r}`,value:"Infrastructure Photo"}),e.jsx("img",{src:t.previewImage?t.previewImage:"/images/default-avatar.jpg",alt:"Infrastructure Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"}),e.jsx("input",{id:`infrastructure_image_${r}`,type:"file",accept:"image/*",onChange:a=>{const c=a.target.files[0];c&&g(c,r,"infrastructure_image")},className:`block w-full text-sm text-gray-500
                                                        file:mr-2 file:py-1 file:px-3
                                                        file:rounded file:border-0
                                                        file:text-xs file:font-semibold
                                                        file:bg-blue-50 file:text-blue-700
                                                        hover:file:bg-blue-100`}),e.jsx(x,{message:f[`infrastructures.${r}.infrastructure_image`],className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(B,{label:"Infrastructure Type",name:"infrastructure_type",value:t.infrastructure_type||"",onChange:a=>g(a.target.value,r,"infrastructure_type"),items:te,placeholder:"Select or Enter Type"}),e.jsx(x,{message:f[`infrastructures.${r}.infrastructure_type`],className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(B,{label:"Infrastructure Category",name:"infrastructure_category",value:t.infrastructure_category||"",onChange:a=>g(a.target.value,r,"infrastructure_category"),placeholder:"Select or Enter Category",items:[{label:"Disaster and Community Facilities",value:"Disaster and Community Facilities"},{label:"Health and Medical",value:"Health and Medical"},{label:"Educational",value:"Educational"},{label:"Agricultural",value:"Agricultural"}]}),e.jsx(x,{message:f[`infrastructures.${r}.infrastructure_category`],className:"mt-1"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(ge,{type:"number",label:"Quantity",name:"quantity",value:t.quantity||"",onChange:a=>g(a.target.value,r,"quantity"),placeholder:"Enter Quantity"}),e.jsx(x,{message:f[`infrastructures.${r}.quantity`],className:"mt-1"})]})]})]})]}),o===null&&e.jsx("button",{type:"button",onClick:()=>ee(r),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(he,{className:"text-2xl"})})]},r)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[o===null?e.jsxs("button",{type:"button",onClick:Z,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(ye,{className:"text-2xl"}),e.jsx("span",{children:"Add Infrastructure"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[o==null&&e.jsxs(b,{type:"button",onClick:()=>F(),children:[e.jsx(Me,{})," Reset"]}),e.jsxs(b,{className:"bg-blue-700 hover:bg-blue-400 ",type:"submit",children:[o?"Update":"Add"," ",e.jsx(ve,{})]})]})]})]})}),e.jsx(Ce,{isOpen:Q,onClose:()=>v(!1),onConfirm:ie,residentId:E})]})]})}export{It as default};
