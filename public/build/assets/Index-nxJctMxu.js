import{r as s,a as E,j as e,K as xe,m as ge,L as pe,S as V}from"./app-CDPwVV6Y.js";import{S as he,C as fe}from"./AdminLayout-BW3ywimG.js";import{B as R}from"./button-B_aprJyo.js";import{I as be}from"./input-DTbtaxsV.js";import ye from"./BreadcrumbsHeader-BOSIhs5m.js";import{t as f,T as je}from"./index-CH7DWExs.js";import we from"./DynamicTable-C_SQJSlc.js";import ve from"./ActionMenu-CazUS606.js";import Ne from"./SidebarModal-CSWrtQJc.js";import Se from"./DynamicTableControls-CcWMFg7f.js";import _e from"./FillterToggle-cYp57TD0.js";import{u as z}from"./useAppUrl-BIsbUUVL.js";import Ce from"./DeleteConfirmationModal-DcMwm5QA.js";import{D as Ee}from"./DropdownInputField-BmM-TOT_.js";import{I as Ae}from"./InputError-CsvCol3W.js";import{I as C}from"./InputField-D_ZI8EKx.js";import{P as De}from"./PasswordValidationChecklist-BZCqZy9b.js";import{S as ke}from"./switch-Zowgx48p.js";import{C as Be}from"./check-BsJSkZwI.js";import{X as Ie}from"./x-rg4AgZHH.js";import{S as Me}from"./search-BLeXCASV.js";import{S as Oe}from"./square-plus-DrV3FpKz.js";import{M as Re}from"./move-right-OicHD8ux.js";import{P as Te}from"./pencil-uQLKno91.js";import{T as Ue}from"./trash-2-DGe7ZjJ3.js";import"./sidebar-BqlEtGlg.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./tooltip-10O7WS77.js";import"./createLucideIcon-B4SoG9zf.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./chevron-right-DYtVQaAj.js";import"./file-text-DhLfxzDZ.js";import"./users-round-BK2vts8v.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./breadcrumb-DsnADmME.js";import"./ellipsis-pjh7Fz_j.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./constants-DHCt9dPc.js";function Fe({data:o,setData:r,originalEmail:w,barangayEmail:v}){const[x,i]=s.useState(null),[p,d]=s.useState(null),[A,g]=s.useState(!1),[y,N]=s.useState(!1),S=z();return s.useEffect(()=>{if(!o.email){i(null),d(null),N(!1);return}i(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)),N(o.email===v)},[o.email,v]),s.useEffect(()=>{if(!x){d(null),g(!1);return}if(o.email===w||y){d(!0),g(!1);return}const h=new AbortController;return g(!0),E.post(`${S}/check-email-unique`,{email:o.email},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},signal:h.signal}).then(b=>{d(b.data.unique)}).catch(b=>{E.isCancel(b)||d(!1)}).finally(()=>g(!1)),()=>h.abort()},[o.email,x,w,y]),e.jsxs("div",{className:"w-full",children:[e.jsx(C,{label:"Email",name:"email",type:"email",value:o.email||"",onChange:h=>r("email",h.target.value)}),x!==null&&e.jsxs("p",{className:`mt-1 text-sm flex items-center gap-1 ${x&&p!==!1?"text-green-600":"text-red-600"}`,children:[x&&p?e.jsx(Be,{className:"w-4 h-4"}):e.jsx(Ie,{className:"w-4 h-4"}),x?A?"Checking uniqueness...":y?"Same as barangay email (allowed)":p===!1?"Email already taken":"Valid and unique email":"Invalid email format"]})]})}function Oa({accounts:o,queryParams:r,barangays:w}){const v=[{label:"Barangay Information",showOnMobile:!1},{label:"Accounts",showOnMobile:!0}];r=r||{};const x=z(),i=xe().props,p=(i==null?void 0:i.success)??null,d=(i==null?void 0:i.error)??null,[A,g]=s.useState(!1),[y,N]=s.useState(null),[S,h]=s.useState(null),[b,K]=s.useState(r.name??""),[H,D]=s.useState(!1),[c,k]=s.useState(""),[Le,J]=s.useState(null),[X,Pe]=s.useState(""),Q=a=>{a.preventDefault(),B("name",b)},B=(a,t)=>{t&&t.trim()!==""?r[a]=t:delete r[a],r.page&&delete r.page,V.get(route("super_admin.accounts",r))},q=(a,t)=>{if(t.key==="Enter")B(a,t.target.value);else return},I=[{key:"id",label:"ID"},{key:"barangay",label:"Barangay"},{key:"name",label:"User Name"},{key:"email",label:"Email"},{key:"status",label:"Session Status"},{key:"account_status",label:"Account Status"},{key:"logged_in",label:"Last Logged In"},{key:"created_at",label:"Date Added"},{key:"actions",label:"Actions"}],M=Object.entries(r||{}).some(([a,t])=>["session_status","account_status"].includes(a)&&t&&t!=="");s.useEffect(()=>{M&&U(!0)},[M]);const[T,U]=s.useState(M),[G,$e]=s.useState(!0),[F,W]=s.useState(!1),[Y,L]=s.useState(o.data.reduce((a,t)=>(a[t.id]=!t.is_disabled,a),{})),Z={id:a=>e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:a.id}),barangay:a=>{var n;const t=(n=a.barangay)==null?void 0:n.barangay_name;return e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:t?`Barangay: ${t}`:"No barangay assigned"})},name:a=>e.jsx("span",{className:"text-sm font-medium text-gray-800",children:a.username??"—"}),email:a=>e.jsx("span",{className:"text-xs text-gray-600",children:a.email??"—"}),status:a=>{var n;const t=a.status==="active";return e.jsx("span",{className:`
                    text-xs font-semibold px-3 py-1 rounded-full transition
                    ${t?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}
                    hover:shadow-sm
                `,children:((n=a.status)==null?void 0:n.toUpperCase())??"—"})},logged_in:a=>{const t=a.updated_at?new Date(a.updated_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—";return e.jsx("span",{className:"text-xs text-gray-500",children:t})},account_status:a=>{const t=Y[a.id]??!0,n=j=>{L(u=>({...u,[a.id]:j})),E.patch(`/user/${a.id}/toggle-account`,{is_disabled:j?0:1}).then(u=>{u.data.success?f.success(u.data.message,{duration:3e3,closeButton:!0}):f.error(u.data.message||"Something went wrong.",{duration:3e3,closeButton:!0})}).catch(()=>{f.error("Failed to update account status.",{duration:3e3,closeButton:!0}),L(u=>({...u,[a.id]:!j}))})};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{checked:t,onCheckedChange:n,className:"bg-gray-200 hover:bg-gray-300"}),e.jsx("span",{className:`text-xs font-semibold ${t?"text-green-700":"text-red-700"}`,children:t?"ENABLED":"DISABLED"})]})},created_at:a=>{const t=a.created_at?new Date(a.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—";return e.jsx("span",{className:"text-xs text-gray-500",children:t})},actions:a=>e.jsx(ve,{actions:[{label:"Edit",icon:e.jsx(Te,{className:"w-4 h-4 text-blue-600"}),onClick:()=>ie(a.id)},{label:"Delete",icon:e.jsx(Ue,{className:"w-4 h-4 text-red-600"}),onClick:()=>de(a.id)}]})},{data:l,setData:m,post:P,errors:ee,reset:ae,clearErrors:te}=ge({barangay_id:null,barangay_name:"",username:"",email:"",password:"",password_confirmation:"",status:"inactive",is_disabled:!1,account_id:null,_method:void 0}),se=I.map(a=>a.key),[_,ne]=s.useState(()=>{const a=localStorage.getItem("accounts_visible_columns");return a?JSON.parse(a):se});s.useEffect(()=>{localStorage.setItem("accounts_visible_columns",JSON.stringify(_))},[_]);const $=w.map(a=>({label:a.barangay_name,value:a.id.toString()})),re=a=>{const t=$.find(n=>n.value.toString()==a.target.value);t?(m("barangay_id",t.value),m("barangay_name",t.label)):(m("barangay_id",""),m("barangay_name",a.target.value))},O=()=>{k(null),D(!1),J(null),N(null),ae(),te()},le=()=>{k("add"),D(!0)},oe=a=>{a.preventDefault(),P(route("super_admin.account.store"))},ie=async a=>{try{const t=await E.get(`${x}/super_admin/details/${a}`);console.log(t);const n=t.data;k("edit"),D(!0),m({barangay_id:n.barangay_id,barangay_name:n.barangay_name||"",username:n.username,email:n.email,originalEmail:n.email,password:"",password_confirmation:"",account_id:n.id,_method:"PUT"})}catch(t){console.error("Error fetching account details:",t),f.error("Failed to fetch account details.")}},ce=a=>{a.preventDefault(),l.account_id&&P(route("super_admin.account.update",l.account_id),{onError:t=>{const n=Object.values(t).map((j,u)=>`<div key=${u}>${j}</div>`);f.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:n.join("")}}),duration:4e3,closeButton:!0})}})},de=a=>{h(a),g(!0)},me=()=>{V.delete(route("user.destroy",S)),g(!1)},ue=()=>{window.print()};return s.useEffect(()=>{p&&(O(),f.success(p,{description:"Operation successful!",duration:3e3,closeButton:!0})),i.success=null},[p]),s.useEffect(()=>{d&&(f.error(d,{description:"Operation failed!",duration:3e3,closeButton:!0}),O()),i.error=null},[d]),e.jsxs(he,{children:[e.jsx(pe,{title:"Account Information"}),e.jsxs("div",{children:[e.jsx(je,{richColors:!0}),e.jsx(ye,{breadcrumbs:v}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-blue-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-blue-100 rounded-full",children:e.jsx(fe,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Barangay Accounts"}),e.jsxs("p",{className:"mt-1 md:mt-2 text-gray-600 text-sm md:text-base",children:["Manage and monitor"," ",e.jsx("span",{className:"font-medium text-gray-800",children:"barangay accounts"})," ","within the system. Use the tools below to"," ",e.jsx("span",{className:"font-medium text-gray-800",children:"create, update, filter, or export"})," ","account information for administrative purposes."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(Se,{allColumns:I,visibleColumns:_,setVisibleColumns:ne,onPrint:ue,showFilters:T,toggleShowFilters:()=>U(a=>!a)})}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:Q,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(be,{type:"text",placeholder:"Search Resident Name",value:b,onChange:a=>K(a.target.value),onKeyDown:a=>q("name",a.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(R,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Me,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(R,{className:"bg-blue-700 hover:bg-blue-400 ",type:"button",onClick:le,children:e.jsx(Oe,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Account"})]})]})})]}),T&&e.jsx(_e,{queryParams:r,searchFieldName:B,visibleFilters:["session_status","account_status"],showFilters:!0,clearRouteName:"super_admin.accounts",clearRouteParams:{}}),e.jsx(we,{passedData:o,allColumns:I,columnRenderers:Z,queryParams:r,is_paginated:G,toggleShowAll:()=>W(!F),showAll:F,visibleColumns:_})]})})}),e.jsx(Ne,{isOpen:H,onClose:O,title:c==="add"?y?"Edit Account Details":"Add Account Details":"View Resident Details",children:(c==="add"||c==="edit")&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:c==="add"?oe:ce,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:c==="add"?"Create Barangay Officer Account":"Edit Barangay Officer Account"}),e.jsx("p",{className:"text-gray-600 text-sm",children:c==="add"?"Select a barangay and provide the account credentials (username, email, and password).":"Update the account credentials and status (password cannot be changed here)."})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl shadow-md border border-gray-200 w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Select Barangay"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Choose the barangay for this officer account. This cannot be changed once the account is created."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-4",children:[e.jsx(Ee,{label:"Barangay",name:"barangay_name",value:l.barangay_name||"",placeholder:"Select a barangay",items:$,disabled:c==="edit",onChange:re,className:"w-full"}),e.jsx(Ae,{message:ee.barangay_id,className:"mt-1 text-red-600"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl shadow-sm space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Account Credentials"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["Set the login credentials for this"," ",e.jsx("span",{className:"font-medium text-gray-800",children:"barangay officer account"}),". The username and email will be used for authentication and notifications."]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(C,{label:"Username",name:"username",value:l.username||"",onChange:a=>m("username",a.target.value)}),e.jsx(Fe,{data:l,setData:m,originalEmail:l.originalEmail??null,barangayEmail:l.barangay_email??null})]}),c==="add"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-600 text-sm",children:["Set a secure password for the account. Make sure it meets the",e.jsxs("span",{className:"font-medium text-gray-800",children:[" ","security requirements"]})," ","below."]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(C,{label:"Password",name:"password",type:"password",value:l.password||"",onChange:a=>m("password",a.target.value)}),e.jsx(C,{label:"Confirm Password",name:"password_confirmation",type:"password",value:l.password_confirmation||"",onChange:a=>m("password_confirmation",a.target.value)})]}),e.jsx(De,{data:l})]}),c==="edit"&&e.jsx("p",{className:"text-gray-500 text-sm",children:'Updating an existing account. Password cannot be changed here. To reset the password, use the "Reset Password" option.'})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(R,{className:"bg-blue-700 hover:bg-blue-400 flex justify-end",type:"submit",disabled:c==="add"&&(!!X||!l.password||!l.password_confirmation),children:[c==="add"?"Create Account":"Update Account"," ",e.jsx(Re,{})]})})]})})}),e.jsx(Ce,{isOpen:A,onClose:()=>{g(!1)},onConfirm:me,residentId:S})]})]})}export{Oa as default};
