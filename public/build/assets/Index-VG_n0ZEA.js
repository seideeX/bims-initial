import{K as me,r as i,m as ue,j as e,L as xe,S as $,a as T}from"./app-CDPwVV6Y.js";import{S as pe,C as he}from"./AdminLayout-BW3ywimG.js";import{B as N}from"./button-B_aprJyo.js";import{I as ge}from"./input-DTbtaxsV.js";import be from"./BreadcrumbsHeader-BOSIhs5m.js";import{T as fe,t as c}from"./index-CH7DWExs.js";import je from"./DynamicTable-C_SQJSlc.js";import ve from"./ActionMenu-CazUS606.js";import{R as ye,A as Ne}from"./constants-DHCt9dPc.js";import we from"./SidebarModal-CSWrtQJc.js";import _e from"./DynamicTableControls-CcWMFg7f.js";import Se from"./FillterToggle-cYp57TD0.js";import{u as Ee}from"./useAppUrl-BIsbUUVL.js";import Ce from"./PersonDetailContent-ghJKAROu.js";import Ae from"./DeleteConfirmationModal-DcMwm5QA.js";import{u as De}from"./handleResidentChange-yybasKmi.js";import{D as ke}from"./DropdownInputField-BmM-TOT_.js";import{I as Re}from"./InputError-CsvCol3W.js";import{I as Ie}from"./InputLabel-C3y8TkvV.js";import{I as x}from"./InputField-D_ZI8EKx.js";import{P as $e}from"./PasswordValidationChecklist-BZCqZy9b.js";import{E as Te}from"./EmailValidationInput-BZQ29zx7.js";import{S as Oe}from"./switch-Zowgx48p.js";import{S as Ue}from"./SelectField-DIeNwIQe.js";import{S as Me}from"./search-BLeXCASV.js";import{S as Be}from"./square-plus-DrV3FpKz.js";import{M as Fe}from"./move-right-OicHD8ux.js";import{P as Le}from"./pencil-uQLKno91.js";import{T as Pe}from"./trash-2-DGe7ZjJ3.js";import"./sidebar-BqlEtGlg.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./createLucideIcon-B4SoG9zf.js";import"./tooltip-10O7WS77.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./chevron-right-DYtVQaAj.js";import"./file-text-DhLfxzDZ.js";import"./users-round-BK2vts8v.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./breadcrumb-DsnADmME.js";import"./ellipsis-pjh7Fz_j.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./iconBase-DNpEM3Pe.js";import"./index-BDJITxkD.js";import"./index-BvB2ajn5.js";function Ht({accounts:w,queryParams:o,residents:_}){const O=[{label:"Barangay Information",showOnMobile:!1},{label:"Accounts",showOnMobile:!0}];o=o||{};const U=Ee(),u=me().props;u==null||u.success,u==null||u.error;const[M,h]=i.useState(!1),[B,F]=i.useState(null),[S,L]=i.useState(null),[E,P]=i.useState(o.name??""),[V,g]=i.useState(!1),[l,b]=i.useState(""),[C,z]=i.useState(null),[H,Ve]=i.useState(""),K=t=>{t.preventDefault(),f("name",E)},f=(t,s)=>{s&&s.trim()!==""?o[t]=s:delete o[t],o.page&&delete o.page,$.get(route("user.index",o))},J=(t,s)=>{if(s.key==="Enter")f(t,s.target.value);else return},X=_.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),j=[{key:"id",label:"ID"},{key:"resident_name",label:"Full Name"},{key:"name",label:"User Name"},{key:"email",label:"Email"},{key:"role",label:"Role"},{key:"status",label:"Session Status"},{key:"account_status",label:"Account Status"},{key:"logged_in",label:"Last Logged In"},{key:"created_at",label:"Date Added"},{key:"actions",label:"Actions"}],v=Object.entries(o||{}).some(([t,s])=>["session_status","account_status"].includes(t)&&s&&s!=="");i.useEffect(()=>{v&&D(!0)},[v]);const[A,D]=i.useState(v),[G,ze]=i.useState(!0),[k,Q]=i.useState(!1),[W,R]=i.useState(w.data.reduce((t,s)=>(t[s.id]=!s.is_disabled,t),{})),Y={id:t=>e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:t.id}),resident_name:t=>{const s=t.resident??{},n=`${s.firstname??""} ${s.middlename??""} ${s.lastname??""} ${s.suffix??""}`.trim();return e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:n||"—"})},name:t=>e.jsx("span",{className:"text-sm font-medium text-gray-800",children:t.username??"—"}),email:t=>e.jsx("span",{className:"text-xs text-gray-600",children:t.email??"—"}),role:t=>e.jsx("span",{className:`text-xs font-medium ${t.role==="barangay_officer"?"text-indigo-600":t.role==="resident"?"text-green-600":"text-gray-400"}`,children:Ne[t.role]??"—"}),status:t=>{var n;const s=t.status==="active";return e.jsx("span",{className:`
                    text-xs font-semibold px-3 py-1 rounded-full transition
                    ${s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}
                    hover:shadow-sm
                `,children:((n=t.status)==null?void 0:n.toUpperCase())??"—"})},logged_in:t=>{const s=t.updated_at?new Date(t.updated_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—";return e.jsx("span",{className:"text-xs text-gray-500",children:s})},account_status:t=>{const s=W[t.id]??!0,n=a=>{R(d=>({...d,[t.id]:a})),T.patch(`/user/${t.id}/toggle-account`,{is_disabled:a?0:1}).then(d=>{d.data.success?c.success(d.data.message,{duration:3e3,closeButton:!0}):c.error(d.data.message||"Something went wrong.",{duration:3e3,closeButton:!0})}).catch(()=>{c.error("Failed to update account status.",{duration:3e3,closeButton:!0}),R(d=>({...d,[t.id]:!a}))})};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{checked:s,onCheckedChange:n,className:"bg-gray-200 hover:bg-gray-300"}),e.jsx("span",{className:`text-xs font-semibold ${s?"text-green-700":"text-red-700"}`,children:s?"ENABLED":"DISABLED"})]})},created_at:t=>{const s=t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—";return e.jsx("span",{className:"text-xs text-gray-500",children:s})},actions:t=>e.jsx(ve,{actions:[{label:"Edit",icon:e.jsx(Le,{className:"w-4 h-4 text-blue-600"}),onClick:()=>ie(t.id)},{label:"Delete",icon:e.jsx(Pe,{className:"w-4 h-4 text-red-600"}),onClick:()=>oe(t.id)}]})},{data:r,setData:m,post:I,errors:Z,reset:q,clearErrors:ee}=ue({resident_id:null,resident_name:"",resident_image:null,birthdate:"",purok_number:"",sex:"",username:"",email:"",password:"",password_confirmation:"",role:"",status:"active",is_disabled:!1,account_id:null,_method:void 0}),te=De(_,m),se=j.map(t=>t.key),[p,ae]=i.useState(()=>{const t=localStorage.getItem("accounts_visible_columns");return t?JSON.parse(t):se});i.useEffect(()=>{localStorage.setItem("accounts_visible_columns",JSON.stringify(p))},[p]);const y=()=>{b(null),g(!1),z(null),F(null),q(),ee()},re=()=>{b("add"),g(!0)},ne=t=>{t.preventDefault(),I(route("user.store"),{onSuccess:()=>{c.success("User account saved successfully!",{description:"The changes have been saved.",duration:3e3,closeButton:!0}),y()},onError:s=>{const n=Object.values(s).map((a,d)=>`<div key=${d}> ${a}</div>`);c.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:n.join("")}}),duration:4e3,closeButton:!0})}})},ie=async t=>{try{const n=(await T.get(`${U}/user/${t}`)).data,a=n.resident;b("edit"),g(!0),m({resident_id:n.resident_id,resident_name:a?`${a.firstname} ${a.middlename} ${a.lastname} ${a.suffix??""}`.trim():"",resident_image:(a==null?void 0:a.image)||null,birthdate:(a==null?void 0:a.birthdate)||"",purok_number:(a==null?void 0:a.purok_number)||"",sex:(a==null?void 0:a.sex)||"",username:n.username,email:n.email,role:n.role,originalEmail:n.email,password:"",password_confirmation:"",account_id:n.id,_method:"PUT"})}catch(s){console.error("Error fetching account details:",s),c.error("Failed to fetch account details.")}},le=t=>{t.preventDefault(),r.account_id&&I(route("user.update",r.account_id),{onSuccess:()=>{c.success("User account updated successfully!",{description:"The changes have been saved.",duration:3e3,closeButton:!0}),y()},onError:s=>{const n=Object.values(s).map((a,d)=>`<div key=${d}>${a}</div>`);c.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:n.join("")}}),duration:4e3,closeButton:!0})}})},oe=t=>{L(t),h(!0)},de=()=>{$.delete(route("user.destroy",S)),h(!1)},ce=()=>{window.print()};return e.jsxs(pe,{children:[e.jsx(xe,{title:"Resident Information"}),e.jsxs("div",{children:[e.jsx(fe,{richColors:!0}),e.jsx(be,{breadcrumbs:O}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(he,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"User Accounts"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Manage and monitor"," ",e.jsx("span",{className:"font-medium",children:"user accounts"})," ","within the system. Use the tools below to"," ",e.jsx("span",{className:"font-medium",children:"create, update, filter, or export"})," ","information for administration and reports."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(_e,{allColumns:j,visibleColumns:p,setVisibleColumns:ae,onPrint:ce,showFilters:A,toggleShowFilters:()=>D(t=>!t)})}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:K,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(ge,{type:"text",placeholder:"Search Resident Name",value:E,onChange:t=>P(t.target.value),onKeyDown:t=>J("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(N,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Me,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(N,{className:"bg-blue-700 hover:bg-blue-400 ",type:"button",onClick:re,children:e.jsx(Be,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Account"})]})]})})]}),A&&e.jsx(Se,{queryParams:o,searchFieldName:f,visibleFilters:["session_status","account_status","account_role"],showFilters:!0,clearRouteName:"user.index",clearRouteParams:{}}),e.jsx(je,{passedData:w,allColumns:j,columnRenderers:Y,queryParams:o,is_paginated:G,toggleShowAll:()=>Q(!k),showAll:k,visibleColumns:p})]})})}),e.jsxs(we,{isOpen:V,onClose:y,title:l==="add"?B?"Edit Account Details":"Add Account Details":"View Resident Details",children:[(l==="add"||l==="edit")&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:l==="add"?ne:le,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2",children:[l==="add"?"Create User Account – ":"Edit User Account – ",r.resident_name||"Select a Resident"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:l==="add"?"Please select a resident and provide the account credentials (username, email, and password).":"Update the account credentials and status (password cannot be changed here)."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 p-6 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx(Ie,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:r.resident_image?`/storage/${r.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow"}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:r.resident_id?"Preview of the selected resident":"Select a resident to view details"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-5",children:[e.jsxs("div",{children:[e.jsx(ke,{label:"Full Name",name:"resident_name",value:r.resident_name||"",placeholder:"Select a resident",onChange:te,items:X,disabled:l==="edit"}),e.jsx(Re,{message:Z.resident_id,className:"mt-1"})]}),r.resident_id&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{label:"Birthdate",name:"birthdate",value:r.birthdate||"",readOnly:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Resident's birthdate"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Purok Number",name:"purok_number",value:r.purok_number||"",readOnly:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Resident's assigned Purok"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Sex",name:"sex",value:ye[r.sex]||"",readOnly:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Resident's gender"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl shadow-sm space-y-6",children:[e.jsx("h4",{className:"text-xl font-semibold text-gray-800",children:"Account Credentials"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{label:"Username",name:"username",value:r.username||"",onChange:t=>m("username",t.target.value)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Enter a unique username for login (letters, numbers, underscores allowed)."})]}),e.jsxs("div",{children:[e.jsx(Te,{data:r,setData:m,originalEmail:r.originalEmail??null}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Enter a valid email address. This will be used for notifications and login."})]}),e.jsxs("div",{children:[e.jsx(Ue,{label:"Role",name:"role",value:r.role||"",onChange:t=>m("role",t.target.value),items:[{value:"barangay_officer",label:"Barangay Officer"},{value:"resident",label:"Resident"}]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:'Select the account role. "Barangay Officer" has admin privileges; "Resident" has limited access.'})]})]}),l==="add"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{label:"Password",name:"password",type:"password",value:r.password||"",onChange:t=>m("password",t.target.value)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Use at least 8 characters, including uppercase, lowercase, numbers, and symbols."})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Confirm Password",name:"password_confirmation",type:"password",value:r.password_confirmation||"",onChange:t=>m("password_confirmation",t.target.value)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Re-enter the password to confirm."})]})]}),l==="add"&&e.jsx($e,{data:r})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(N,{className:"bg-blue-700 hover:bg-blue-400 flex justify-end",type:"submit",disabled:l==="add"&&(!!H||!r.password||!r.password_confirmation),children:[l==="add"?"Create Account":"Update Account"," ",e.jsx(Fe,{})]})})]})}),l==="view"&&C?e.jsx(Ce,{person:C}):null]}),e.jsx(Ae,{isOpen:M,onClose:()=>{h(!1)},onConfirm:de,residentId:S})]})]})}export{Ht as default};
