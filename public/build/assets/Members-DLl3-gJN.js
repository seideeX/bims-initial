import{K as $e,r as o,m as Ee,j as e,L as Ce,S as q,a as ee}from"./app-CDPwVV6Y.js";import{S as Ie}from"./AdminLayout-BW3ywimG.js";import{B as y}from"./button-B_aprJyo.js";import{I as Me}from"./input-DTbtaxsV.js";import Re from"./BreadcrumbsHeader-BOSIhs5m.js";import{t as u,T as Oe}from"./index-CH7DWExs.js";import Ae from"./DynamicTable-C_SQJSlc.js";import Le from"./ActionMenu-CazUS606.js";import{R as Fe,b as Te}from"./constants-DHCt9dPc.js";import Be from"./SidebarModal-CSWrtQJc.js";import Ue from"./DynamicTableControls-CcWMFg7f.js";import Ve from"./FillterToggle-cYp57TD0.js";import{u as He}from"./useAppUrl-BIsbUUVL.js";import ze from"./PersonDetailContent-ghJKAROu.js";import Pe from"./DeleteConfirmationModal-DcMwm5QA.js";import{D as Ke}from"./DropdownInputField-BmM-TOT_.js";import{I}from"./InputError-CsvCol3W.js";import{I as M}from"./InputLabel-C3y8TkvV.js";import{I as R}from"./InputField-D_ZI8EKx.js";import{I as Ge,a as Ye,b as Qe}from"./index-D4O4cOmu.js";import{E as Xe}from"./ExportButton-CO89vrVN.js";import{U as Je}from"./users-round-BK2vts8v.js";import{S as We}from"./search-BLeXCASV.js";import{L as Ze}from"./list-plus-D4__nvo2.js";import{R as qe}from"./rotate-ccw-D-jj88si.js";import{E as et}from"./eye-CTOC_KFU.js";import{S as tt}from"./square-pen-7JDEATcf.js";import{T as st}from"./trash-2-DGe7ZjJ3.js";import"./sidebar-BqlEtGlg.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./createLucideIcon-B4SoG9zf.js";import"./tooltip-10O7WS77.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./chevron-right-DYtVQaAj.js";import"./file-text-DhLfxzDZ.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./breadcrumb-DsnADmME.js";import"./ellipsis-pjh7Fz_j.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./iconBase-DNpEM3Pe.js";import"./index-BDJITxkD.js";import"./index-BvB2ajn5.js";import"./file-output-BVnTKX-L.js";function ss({members:te,puroks:se,queryParams:i,residents:O,institution:p}){const re=[{label:"Barangay Information",showOnMobile:!1},{label:"Institution",showOnMobile:!1},{label:"Institution Members",showOnMobile:!0}];i=i||{};const A=He(),m=$e().props,_=(m==null?void 0:m.success)??null,N=(m==null?void 0:m.error)??null,[ae,w]=o.useState(!1),[L,ne]=o.useState(null),[x,S]=o.useState(null),[F,ie]=o.useState(i.name??""),[le,f]=o.useState(!1),[k,j]=o.useState(""),[T,B]=o.useState(null),oe=t=>{t.preventDefault(),D("name",F)},D=(t,s)=>{s&&s.trim()!==""?i[t]=s:delete i[t],i.page&&delete i.page,q.get(route("barangay_institution.show",p.id),i)},me=(t,s)=>{if(s.key==="Enter")D(t,s.target.value);else return},$=[{key:"id",label:"ID"},{key:"name",label:"Resident Name"},{key:"sex",label:"Sex"},{key:"age",label:"Age"},{key:"birthdate",label:"Date of Birth"},{key:"member_since",label:"Date of Membership"},{key:"status",label:"Status"},{key:"contact_number",label:"Contact Number"},{key:"purok_number",label:"Purok Number"},{key:"actions",label:"Actions"}],de=O.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),[U,V]=o.useState($.map(t=>t.key)),E=Object.entries(i||{}).some(([t,s])=>["purok","sex","age_group","pwd","fourps","solo_parent"].includes(t)&&s&&s!=="");o.useEffect(()=>{E&&z(!0)},[E]);const[H,z]=o.useState(E),ce=()=>{window.print()},ue=t=>{if(!t)return"Unknown";const s=new Date(t),r=new Date;let a=r.getFullYear()-s.getFullYear();const l=r.getMonth()-s.getMonth();return(l<0||l===0&&r.getDate()<s.getDate())&&a--,a},pe={id:t=>e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:t.id}),name:t=>{const s=t.resident,r=t.is_head===1;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-800",children:[s.firstname," ",s.middlename??""," ",s.lastname," ",e.jsx("span",{className:"text-gray-500",children:s.suffix??""})]}),r&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] font-semibold rounded-full bg-blue-100 text-blue-800",children:"Head"})]})},sex:t=>{var l,b,h;const s=(l=t.resident)==null?void 0:l.sex,r=((b=Fe)==null?void 0:b[s])??s??"Unknown",a=((h=Te)==null?void 0:h[s])??"bg-gray-100 text-gray-800";return e.jsx("span",{className:`py-1 px-3 rounded-full text-xs font-semibold shadow-sm whitespace-nowrap ${a}`,children:r})},contact_number:t=>{var a;const s=(a=t.resident)==null?void 0:a.contact_number,r=s||"—";return e.jsx("span",{className:"text-xs font-medium text-gray-700 capitalize",children:r})},age:t=>{const s=t.resident,r=ue(s.birthdate);return r===null?e.jsx("span",{className:"italic text-gray-400",children:"Unknown"}):e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("span",{className:"font-bold text-indigo-700",children:[r," yrs"]}),r>60&&e.jsx("span",{className:"text-xs text-rose-500 font-semibold mt-0.5",children:"Senior Citizen"})]})},birthdate:t=>{var s;return(s=t.resident)!=null&&s.birthdate?e.jsx("span",{className:"text-gray-700 text-sm",children:new Date(t.resident.birthdate).toLocaleDateString()}):e.jsx("span",{className:"italic text-gray-400",children:"—"})},member_since:t=>t.member_since?e.jsx("span",{className:"text-indigo-600 font-medium text-sm",children:new Date(t.member_since).toLocaleDateString()}):e.jsx("span",{className:"italic text-gray-400",children:"—"}),status:t=>{const s=t.status,r={active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-700"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold shadow-sm ${r[s]??"bg-gray-100 text-gray-600"}`,children:s})},purok_number:t=>{var s;return e.jsx("span",{className:"text-gray-700 font-medium",children:((s=t.resident)==null?void 0:s.purok_number)??"—"})},actions:t=>e.jsx(Le,{actions:[{label:"View",icon:e.jsx(et,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>{var s;return we((s=t.resident)==null?void 0:s.id)}},{label:"Edit",icon:e.jsx(tt,{className:"w-4 h-4 text-green-500"}),onClick:()=>ye(t.id)},{label:"Delete",icon:e.jsx(st,{className:"w-4 h-4 text-red-600"}),onClick:()=>_e(t.id)}]})},{data:c,setData:d,post:P,errors:v,reset:K,clearErrors:xe}=Ee({members:[{resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,member_since:"",status:"active",is_head:!1}],institution_id:null,member_id:null,_method:void 0}),be=(t,s)=>{const r=O.find(l=>l.id==t.target.value),a=[...c.members];a[s]={...a[s],resident_id:(r==null?void 0:r.id)||null,resident_name:`${r.firstname} ${r.middlename} ${r.lastname} ${r.suffix??""}`||"",birthdate:(r==null?void 0:r.birthdate)||null,purok_number:(r==null?void 0:r.purok_number)||null,resident_image:(r==null?void 0:r.image)||null},d("members",a),d("institution_id",p.id)},C=(t,s,r)=>{const a=[...c.members];a[s][r]=t.target.type==="checkbox"?t.target.checked:t.target.value,d("members",a)},he=()=>{d("members",[...c.members,{resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,member_since:"",status:"active",is_head:!1}])},ge=t=>{const s=[...c.members];s.splice(t,1),d("members",s),u.warning("Member removed.",{duration:2e3})},fe=()=>{j("add"),f(!0)},je=t=>{t.preventDefault(),P(route("institution_member.store"),{onError:s=>{const r=Object.values(s).map((a,l)=>`<div key=${l}> ${a}</div>`);u.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:r.join("")}}),duration:4e3,closeButton:!0})}})},ve=t=>{t.preventDefault(),P(route("institution_member.update",c.member_id),{onError:()=>{const s=Object.values(v).map((r,a)=>`<div key=${a}> ${r}</div>`);u.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.join("")}}),duration:4e3,closeButton:!0})}})},G=()=>{j(null),f(!1),B(null),S(null),K(),xe()},ye=async t=>{var s,r,a,l,b,h,Y,Q,X,J,W;j("add"),S(null);try{const n=(await ee.get(`${A}/institution_member/details/${t}`)).data.member;S(n),d("member_id",n.id),d("_method","PUT"),d("members",[{resident_id:((s=n.resident)==null?void 0:s.id)??null,resident_name:`${((r=n.resident)==null?void 0:r.firstname)??""} ${((a=n.resident)==null?void 0:a.middlename)??""} ${((l=n.resident)==null?void 0:l.lastname)??""} ${((b=n.resident)==null?void 0:b.suffix)??""}`.trim(),resident_image:((h=n.resident)==null?void 0:h.image)??null,birthdate:((Y=n.resident)==null?void 0:Y.birthdate)??null,purok_number:((Q=n.resident)==null?void 0:Q.purok_number)??null,member_since:n.member_since??"",status:n.status??"active",is_head:n.is_head??!1}])}catch(g){console.error("Error fetching member details:",g);let n="Error",Z="Something went wrong. Please try again.";if(((X=g.response)==null?void 0:X.status)===422&&((W=(J=g.response)==null?void 0:J.data)!=null&&W.errors)){n="Validation Error";const Se=Object.values(g.response.data.errors).flat();Z=e.jsx("ul",{className:"list-disc ml-5",children:Se.map((ke,De)=>e.jsx("li",{children:ke},De))})}u.error(n,{description:Z,duration:4e3,closeButton:!0})}finally{f(!0)}},_e=t=>{ne(t),w(!0)},Ne=()=>{q.delete(route("institution_member.destroy",L),{onError:t=>{const s=Object.values(t).map((r,a)=>`<div key=${a}> ${r}</div>`);u.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.join("")}}),duration:4e3,closeButton:!0})}}),w(!1)},we=async t=>{j("view");try{const s=await ee.get(`${A}/resident/showresident/${t}`);B(s.data.resident)}catch(s){console.error("Error fetching placeholders:",s)}f(!0)};return o.useEffect(()=>{_&&(G(),u.success(_,{description:"Operation successful!",duration:3e3,closeButton:!0})),m.success=null},[_]),o.useEffect(()=>{N&&u.error(N,{description:"Operation failed!",duration:3e3,closeButton:!0}),m.error=null},[N]),e.jsxs(Ie,{children:[e.jsx(Ce,{title:"Resident Information"}),e.jsxs("div",{children:[e.jsx(Oe,{richColors:!0}),e.jsx(Re,{breadcrumbs:re}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(Je,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:[p.name," Overview"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Review, filter, and manage members of ",p.name," efficiently."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx(Ue,{allColumns:$,visibleColumns:U,setVisibleColumns:V,onPrint:ce,showFilters:H,toggleShowFilters:()=>z(t=>!t)}),e.jsx(Xe,{url:`/report/export-institution-members-pdf/${p.id}`,queryParams:i,label:"Export Members as PDF",type:"pdf"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:oe,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(Me,{type:"text",placeholder:"Search Resident Name",value:F,onChange:t=>ie(t.target.value),onKeyDown:t=>me("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(y,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(We,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(y,{className:"bg-blue-700 hover:bg-blue-400 ",type:"button",onClick:fe,children:e.jsx(Ze,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Institution Member"})]})]})})]}),H&&e.jsx(Ve,{queryParams:i,searchFieldName:D,visibleFilters:["purok","sex","age_group","pwd","fourps","solo_parent"],puroks:se,showFilters:!0,clearRouteName:"barangay_institution.show",clearRouteParams:{id:p.id}}),e.jsx(Ae,{passedData:te,allColumns:$,columnRenderers:pe,queryParams:i,visibleColumns:U,setVisibleColumns:V})]})})}),e.jsxs(Be,{isOpen:le,onClose:G,title:k==="add"?x?"Edit Resident Death Details":"Add Resident Death Details":"View Resident Details",children:[k==="add"&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:x?ve:je,children:[c.members.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 mb-3 flex items-center gap-2",children:["Institution Member –"," ",t.resident_name||"Select a Resident"]}),e.jsx("p",{className:"text-gray-600 mb-6 text-sm",children:"Please provide the membership details of the resident, including their status and role."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-2 md:gap-x-4 mb-5 w-full",children:[e.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(M,{htmlFor:`resident_image_${s}`,value:"Profile Photo"}),e.jsx("img",{src:t.resident_image?`/storage/${t.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx(Ke,{label:"Full Name",name:`members.${s}.resident_name`,value:t.resident_name||"",placeholder:"Select a resident",onChange:r=>be(r,s),items:de}),e.jsx(I,{message:v[`members.${s}.resident_id`],className:"mt-2"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx(R,{label:"Birthdate",name:`members.${s}.birthdate`,value:t.birthdate||"",readOnly:!0}),e.jsx(R,{label:"Purok Number",name:`members.${s}.purok_number`,value:t.purok_number||"",readOnly:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(M,{value:"Member Since"}),e.jsx(R,{type:"date",name:`members.${s}.member_since`,value:t.member_since||"",onChange:r=>C(r,s,"member_since")}),e.jsx(I,{message:v[`members.${s}.member_since`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(M,{value:"Status"}),e.jsxs("select",{name:`members.${s}.status`,value:t.status||"active",onChange:r=>C(r,s,"status"),className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx(I,{message:v[`members.${s}.status`],className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:`is_head_${s}`,checked:!!t.is_head,onChange:r=>C(r,s,"is_head"),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("label",{htmlFor:`is_head_${s}`,className:"text-sm text-gray-700",children:"Set as Head of Institution"})]})]})]}),c.members.length>1&&e.jsx("button",{type:"button",onClick:()=>ge(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium transition-colors duration-200",children:e.jsx(Ge,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[x===null?e.jsxs("button",{type:"button",onClick:he,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Ye,{className:"text-2xl"}),e.jsx("span",{children:"Add Member"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[x===null&&e.jsxs(y,{type:"button",onClick:()=>K(),children:[e.jsx(qe,{})," Reset"]}),e.jsxs(y,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[x?"Update":"Add"," ",e.jsx(Qe,{})]})]})]})]})}),k==="view"&&T?e.jsx(ze,{person:T}):null]}),e.jsx(Pe,{isOpen:ae,onClose:()=>{w(!1)},onConfirm:Ne,residentId:L})]})]})}export{ss as default};
