import{r,K as ie,m as ne,j as e,L as ce,S as $,a as de}from"./app-CDPwVV6Y.js";import me from"./DynamicTable-C_SQJSlc.js";import{u as ue}from"./useAppUrl-BIsbUUVL.js";import{S as pe,H as ge}from"./AdminLayout-BW3ywimG.js";import xe from"./ActionMenu-CazUS606.js";import be from"./DynamicTableControls-CcWMFg7f.js";import{I as je}from"./input-DTbtaxsV.js";import{B as h}from"./button-B_aprJyo.js";import he from"./FillterToggle-cYp57TD0.js";import{P as fe,c as ve}from"./constants-DHCt9dPc.js";import ye from"./SidebarModal-CSWrtQJc.js";import{I as x}from"./InputField-D_ZI8EKx.js";import{I as n}from"./InputError-CsvCol3W.js";import{D as B}from"./DropdownInputField-BmM-TOT_.js";import{T as _e}from"./textarea-CVDV7Abf.js";import{S as Ne}from"./SelectField-DIeNwIQe.js";import{I as Se,a as Ce,b as we}from"./index-D4O4cOmu.js";import{t as d,T as Ee}from"./index-CH7DWExs.js";import De from"./DeleteConfirmationModal-DcMwm5QA.js";import{I as Te}from"./InputLabel-C3y8TkvV.js";import Oe from"./BreadcrumbsHeader-BOSIhs5m.js";import{S as ke}from"./search-BLeXCASV.js";import{L as Pe}from"./list-plus-D4__nvo2.js";import{R as Fe}from"./rotate-ccw-D-jj88si.js";import{E as Ae}from"./eye-CTOC_KFU.js";import{S as Re}from"./square-pen-7JDEATcf.js";import{T as $e}from"./trash-2-DGe7ZjJ3.js";import"./createLucideIcon-B4SoG9zf.js";import"./sidebar-BqlEtGlg.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./tooltip-10O7WS77.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./chevron-right-DYtVQaAj.js";import"./file-text-DhLfxzDZ.js";import"./users-round-BK2vts8v.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./ellipsis-pjh7Fz_j.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./iconBase-DNpEM3Pe.js";import"./breadcrumb-DsnADmME.js";const Ft=({projects:L,institutions:M,categories:I,queryParams:l})=>{const U=[{label:"Barangay Resources",showOnMobile:!1},{label:"Infrastructures",showOnMobile:!0}],V=ue();l=l||{};const[H,f]=r.useState(!1),[J,v]=r.useState(""),[m,D]=r.useState(null),[T,K]=r.useState(l.name??""),[z,y]=r.useState(!1),[O,k]=r.useState(null),c=ie().props,_=(c==null?void 0:c.success)??null,N=(c==null?void 0:c.error)??null,S=[{key:"id",label:"ID"},{key:"title",label:"Title"},{key:"image",label:"Project Image"},{key:"description",label:"Description"},{key:"status",label:"Status"},{key:"category",label:"Category"},{key:"responsible_institution",label:"Responsible Institution"},{key:"budget",label:"Budget"},{key:"funding_source",label:"Funding Source"},{key:"start_date",label:"Start Date"},{key:"end_date",label:"End Date"},{key:"actions",label:"Actions"}],G=S.map(t=>t.key),[b,Q]=r.useState(()=>{const t=localStorage.getItem("projects_visible_columns");return t?JSON.parse(t):G});r.useEffect(()=>{localStorage.setItem("projects_visible_columns",JSON.stringify(b))},[b]);const C=Object.entries(l||{}).some(([t,s])=>["project_status","project_category","responsible_inti","start_date","end_date"].includes(t)&&s&&s!=="");r.useEffect(()=>{C&&P(!0)},[C]);const[w,P]=r.useState(C),X=t=>{t.preventDefault(),E("name",T)},E=(t,s)=>{s&&s.trim()!==""?l[t]=s:delete l[t],l.page&&delete l.page,$.get(route("barangay_project.index",l))},W=(t,s)=>{s.key==="Enter"&&E(t,s.target.value)},Y={id:t=>e.jsx("span",{className:"text-gray-600 text-sm",children:t.id}),image:t=>e.jsx("img",{src:t.project_image?`/storage/${t.project_image}`:"/images/default-avatar.jpg",onError:s=>{s.target.onerror=null,s.target.src="/images/default-avatar.jpg"},alt:"Resident",className:"w-16 h-16 min-w-16 min-h-16 object-cover rounded-sm border"}),title:t=>e.jsx("span",{className:"font-semibold text-gray-900",children:t.title||"—"}),description:t=>e.jsx("span",{className:"text-gray-700 text-sm",children:t.description?t.description.length>50?t.description.substring(0,50)+"...":t.description:"—"}),status:t=>{var a;const s=(a=t.status)==null?void 0:a.toLowerCase();return e.jsx("span",{className:ve[s]||"bg-gray-100 px-2 py-1 rounded-lg text-gray-800 text-xs",children:fe[s]||t.status||"—"})},category:t=>e.jsx("span",{className:"text-gray-800 text-sm",children:t.category||"—"}),responsible_institution:t=>e.jsx("span",{className:"text-gray-700",children:t.responsible_institution||"—"}),budget:t=>e.jsx("span",{className:"font-medium text-indigo-700",children:t.budget?`₱${parseFloat(t.budget).toLocaleString()}`:"—"}),funding_source:t=>e.jsx("span",{className:"text-gray-600",children:t.funding_source||"—"}),start_date:t=>e.jsx("span",{className:"text-gray-500 text-sm",children:t.start_date||"—"}),end_date:t=>e.jsx("span",{className:"text-gray-500 text-sm",children:t.end_date||"—"}),actions:t=>e.jsx(xe,{actions:[{label:"View",icon:e.jsx(Ae,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>handleView(t.id)},{label:"Edit",icon:e.jsx(Re,{className:"w-4 h-4 text-green-500"}),onClick:()=>ae(t.id)},{label:"Delete",icon:e.jsx($e,{className:"w-4 h-4 text-red-600"}),onClick:()=>le(t.id)}]})},Z=()=>{v("add"),f(!0)},{data:u,setData:j,post:F,errors:o,reset:A,clearErrors:q}=ne({projects:[[]],_method:void 0,project_id:null}),ee=()=>{j("projects",[...u.projects||[],{}])},te=t=>{const s=[...u.projects||[]];s.splice(t,1),j("projects",s),d.warning("Project removed.",{duration:2e3})},R=()=>{f(!1),v(""),D(null),k(null),A(),q()},i=(t,s,a)=>{j(p=>{const g=[...p.projects];return a==="project_image"&&t instanceof File?g[s]={...g[s],project_image:t,previewImage:URL.createObjectURL(t)}:g[s]={...g[s],[a]:t},{...p,projects:g}})},se=t=>{t.preventDefault(),F(route("barangay_project.store"),{onError:s=>{console.error("Validation Errors:",s);const a=Object.values(s).join("<br />");d.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}})},ae=async t=>{v("edit");try{const a=(await de.get(`${V}/barangay_project/details/${t}`)).data.project;console.log(a),D(a),j({projects:[{title:a.title||"",description:a.description||"",project_image:null,previewImage:a.project_image?`/storage/${a.project_image}`:null,status:a.status||"planning",category:a.category||"",responsible_institution:a.responsible_institution||"",budget:a.budget||0,funding_source:a.funding_source||"",start_date:a.start_date||"",end_date:a.end_date||""}],_method:"PUT",project_id:a.id}),f(!0)}catch(s){console.error("Error fetching project details:",s)}},re=t=>{t.preventDefault(),F(route("barangay_project.update",u.project_id),{onError:s=>{console.error("Validation Errors:",s);const a=Object.values(s).join("<br />");d.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}})},le=t=>{k(t),y(!0)},oe=()=>{$.delete(route("barangay_project.destroy",O),{onError:t=>{console.error("Validation Errors:",t);const s=Object.values(t).join("<br />");d.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})}}),y(!1)};return r.useEffect(()=>{_&&(R(),d.success(_,{description:"Operation successful!",duration:3e3,closeButton:!0})),c.success=null},[_]),r.useEffect(()=>{N&&d.error(N,{description:"Operation failed!",duration:3e3,closeButton:!0}),c.error=null},[N]),e.jsxs(pe,{children:[e.jsx(ce,{title:"Barangay Infrastructure"}),e.jsx(Oe,{breadcrumbs:U}),e.jsx(Ee,{richColors:!0}),e.jsxs("div",{className:"pt-4 mb-10",children:[e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(ge,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Barangay Projects Overview"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review, filter, and manage ongoing and completed projects implemented by barangay institutions."})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(be,{allColumns:S,visibleColumns:b,setVisibleColumns:Q,showFilters:w,toggleShowFilters:()=>P(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:X,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(je,{type:"text",placeholder:"Search title or description ",value:T,onChange:t=>K(t.target.value),onKeyDown:t=>W("name",t.target.value),className:"ml-4"}),e.jsx(h,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(ke,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(h,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:Z,children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add a Project"})]})]})]}),w&&e.jsx(he,{queryParams:l,searchFieldName:E,visibleFilters:["project_status","project_category","responsible_inti","start_date","end_date"],categories:I,institutions:M,clearRouteName:"barangay_project.index",clearRouteParams:{},showFilters:w}),e.jsx(me,{queryParams:l,passedData:L,allColumns:S,columnRenderers:Y,visibleColumns:b,showTotal:!0})]})]})}),e.jsx(ye,{isOpen:H,onClose:()=>{R()},title:J=="add"?"Add Project":"Edit Project",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:m?re:se,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Development Projects"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about barangay projects, their status, funding, and responsible institutions."}),Array.isArray(u.projects)&&u.projects.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Te,{htmlFor:`facility_image_${s}`,value:"Facility Photo"}),e.jsx("img",{src:t.previewImage||"/images/default-avatar.jpg",alt:"Project Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"}),e.jsx("input",{id:`facility_image_${s}`,type:"file",accept:"image/*",onChange:a=>{const p=a.target.files[0];p&&i(p,s,"project_image")},className:`block w-full text-sm text-gray-500
                                                                                                                                file:mr-2 file:py-1 file:px-3
                                                                                                                                file:rounded file:border-0
                                                                                                                                file:text-xs file:font-semibold
                                                                                                                                file:bg-blue-50 file:text-blue-700
                                                                                                                                hover:file:bg-blue-100`}),e.jsx(n,{message:o[`projects.${s}.project_image`],className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{label:"Project Title",name:"title",value:t.title||"",onChange:a=>i(a.target.value,s,"title"),placeholder:"e.g. Barangay Health Center Construction"}),e.jsx(n,{message:o[`projects.${s}.title`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(B,{label:"Category",name:"category",value:t.category||"",onChange:a=>i(a.target.value,s,"category"),placeholder:"Select category",items:[{label:"Infrastructure",value:"infrastructure"},{label:"Health",value:"health"},{label:"Education",value:"education"},{label:"Livelihood",value:"livelihood"},{label:"Others",value:"others"}]}),e.jsx(n,{message:o[`projects.${s}.category`],className:"mt-1"})]})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx(_e,{label:"Description",name:"description",value:t.description||"",onChange:a=>i(a.target.value,s,"description"),className:"text-gray-600",placeholder:"Brief description of the project..."}),e.jsx(n,{message:o[`projects.${s}.description`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Ne,{label:"Status",name:"status",value:t.status||"",onChange:a=>i(a.target.value,s,"status"),items:[{label:"Planning",value:"planning"},{label:"Ongoing",value:"ongoing"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}]}),e.jsx(n,{message:o[`projects.${s}.status`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(B,{label:"Responsible Institution",name:"responsible_institution",value:t.responsible_institution||"",onChange:a=>i(a.target.value,s,"responsible_institution"),placeholder:"Enter institution"}),e.jsx(n,{message:o[`projects.${s}.responsible_institution`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{type:"number",step:"0.01",label:"Budget (₱)",name:"budget",value:t.budget||"",onChange:a=>i(a.target.value,s,"budget"),placeholder:"e.g. 500000"}),e.jsx(n,{message:o[`projects.${s}.budget`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(x,{label:"Funding Source",name:"funding_source",value:t.funding_source||"",onChange:a=>i(a.target.value,s,"funding_source"),placeholder:"e.g. LGU, NGO, National Government"}),e.jsx(n,{message:o[`projects.${s}.funding_source`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{type:"date",label:"Start Date",name:"start_date",value:t.start_date||"",onChange:a=>i(a.target.value,s,"start_date")}),e.jsx(n,{message:o[`projects.${s}.start_date`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{type:"date",label:"End Date",name:"end_date",value:t.end_date||"",onChange:a=>i(a.target.value,s,"end_date")}),e.jsx(n,{message:o[`projects.${s}.end_date`],className:"mt-1"})]})]}),m===null&&e.jsx("button",{type:"button",onClick:()=>te(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(Se,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[m===null?e.jsxs("button",{type:"button",onClick:ee,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Ce,{className:"text-2xl"}),e.jsx("span",{children:"Add Project"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[m==null&&e.jsxs(h,{type:"button",onClick:()=>A(),children:[e.jsx(Fe,{})," Reset"]}),e.jsxs(h,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[m?"Update":"Add"," ",e.jsx(we,{})]})]})]})]})}),e.jsx(De,{isOpen:z,onClose:()=>{y(!1)},onConfirm:oe,residentId:O})]})]})};export{Ft as default};
