import{r as W,j as l,K as je,m as ze,L as Ne}from"./app-CDPwVV6Y.js";import Se from"./BreadcrumbsHeader-BOSIhs5m.js";import{D as ge}from"./DropdownInputField-BmM-TOT_.js";import{S as xe,r as Me,d as ke,i as ve,T as re,a as oe}from"./transform-D9mgzNNR.js";import{f as Te}from"./index-D4O4cOmu.js";import we from"./SidebarModal-CSWrtQJc.js";import Ee,{personDetailTitle as Re}from"./PersonDetailContent-ghJKAROu.js";import{I as se}from"./InputError-CsvCol3W.js";import{I as te}from"./InputField-D_ZI8EKx.js";import{I as ae}from"./InputLabel-C3y8TkvV.js";import{S as Ce}from"./SelectField-DIeNwIQe.js";import{B as ye}from"./button-B_aprJyo.js";import{S as Ie}from"./AdminLayout-BW3ywimG.js";import{t as le,T as $e}from"./index-CH7DWExs.js";import{c as Be}from"./createLucideIcon-B4SoG9zf.js";import"./breadcrumb-DsnADmME.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./chevron-right-DYtVQaAj.js";import"./sidebar-BqlEtGlg.js";import"./input-DTbtaxsV.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./tooltip-10O7WS77.js";import"./string-BbYD24iH.js";import"./iconBase-DNpEM3Pe.js";import"./index-BDJITxkD.js";import"./constants-DHCt9dPc.js";import"./index-BvB2ajn5.js";import"./heart-pulse-BRIexC2Z.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./useAppUrl-BIsbUUVL.js";import"./DeleteConfirmationModal-DcMwm5QA.js";import"./file-text-DhLfxzDZ.js";import"./users-round-BK2vts8v.js";import"./chevron-up-BBBA9wsx.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Ae=Be("workflow",Xe);var De=1e-12;function be(e){return((e=Math.exp(e))+1/e)/2}function Oe(e){return((e=Math.exp(e))-1/e)/2}function Ye(e){return((e=Math.exp(2*e))-1)/(e+1)}const Le=function e(t,r,o){function u(m,h){var j=m[0],B=m[1],a=m[2],z=h[0],_=h[1],d=h[2],C=z-j,E=_-B,$=C*C+E*E,D,y;if($<De)y=Math.log(d/a)/t,D=function(V){return[j+V*C,B+V*E,a*Math.exp(t*V*y)]};else{var T=Math.sqrt($),w=(d*d-a*a+o*$)/(2*a*r*T),N=(d*d-a*a-o*$)/(2*d*r*T),O=Math.log(Math.sqrt(w*w+1)-w),L=Math.log(Math.sqrt(N*N+1)-N);y=(L-O)/t,D=function(V){var Y=V*y,F=be(O),k=a/(r*T)*(F*Ye(t*Y+O)-Oe(O));return[j+k*C,B+k*E,a*F/be(t*Y+O)]}}return D.duration=y*1e3*t/Math.SQRT2,D}return u.rho=function(m){var h=Math.max(.001,+m),j=h*h,B=j*j;return e(h,j,B)},u}(Math.SQRT2,2,4);function H(e){return typeof e=="string"?new xe([[document.querySelector(e)]],[document.documentElement]):new xe([[e]],Me)}function Pe(e){let t;for(;t=e.sourceEvent;)e=t;return e}function q(e,t){if(e=Pe(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var o=r.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,o=o.matrixTransform(t.getScreenCTM().inverse()),[o.x,o.y]}if(t.getBoundingClientRect){var u=t.getBoundingClientRect();return[e.clientX-u.left-t.clientLeft,e.clientY-u.top-t.clientTop]}}return[e.pageX,e.pageY]}const de={capture:!0,passive:!1};function me(e){e.preventDefault(),e.stopImmediatePropagation()}function Fe(e){var t=e.document.documentElement,r=H(e).on("dragstart.drag",me,de);"onselectstart"in t?r.on("selectstart.drag",me,de):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ve(e,t){var r=e.document.documentElement,o=H(e).on("dragstart.drag",null);t&&(o.on("click.drag",me,de),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in r?o.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}function We(e){var t=0,r=e.children,o=r&&r.length;if(!o)t=1;else for(;--o>=0;)t+=r[o].value;e.value=t}function Ge(){return this.eachAfter(We)}function He(e,t){let r=-1;for(const o of this)e.call(t,o,++r,this);return this}function qe(e,t){for(var r=this,o=[r],u,m,h=-1;r=o.pop();)if(e.call(t,r,++h,this),u=r.children)for(m=u.length-1;m>=0;--m)o.push(u[m]);return this}function Ke(e,t){for(var r=this,o=[r],u=[],m,h,j,B=-1;r=o.pop();)if(u.push(r),m=r.children)for(h=0,j=m.length;h<j;++h)o.push(m[h]);for(;r=u.pop();)e.call(t,r,++B,this);return this}function Ue(e,t){let r=-1;for(const o of this)if(e.call(t,o,++r,this))return o}function Qe(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,o=t.children,u=o&&o.length;--u>=0;)r+=o[u].value;t.value=r})}function Ze(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function Je(e){for(var t=this,r=et(t,e),o=[t];t!==r;)t=t.parent,o.push(t);for(var u=o.length;e!==r;)o.splice(u,0,e),e=e.parent;return o}function et(e,t){if(e===t)return e;var r=e.ancestors(),o=t.ancestors(),u=null;for(e=r.pop(),t=o.pop();e===t;)u=e,e=r.pop(),t=o.pop();return u}function tt(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function nt(){return Array.from(this)}function it(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function rt(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t}function*ot(){var e=this,t,r=[e],o,u,m;do for(t=r.reverse(),r=[];e=t.pop();)if(yield e,o=e.children)for(u=0,m=o.length;u<m;++u)r.push(o[u]);while(r.length)}function fe(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=lt)):t===void 0&&(t=at);for(var r=new J(e),o,u=[r],m,h,j,B;o=u.pop();)if((h=t(o.data))&&(B=(h=Array.from(h)).length))for(o.children=h,j=B-1;j>=0;--j)u.push(m=h[j]=new J(h[j])),m.parent=o,m.depth=o.depth+1;return r.eachBefore(ut)}function st(){return fe(this).eachBefore(ct)}function at(e){return e.children}function lt(e){return Array.isArray(e)?e[1]:null}function ct(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function ut(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function J(e){this.data=e,this.depth=this.height=0,this.parent=null}J.prototype=fe.prototype={constructor:J,count:Ge,each:He,eachAfter:Ke,eachBefore:qe,find:Ue,sum:Qe,sort:Ze,path:Je,ancestors:tt,descendants:nt,leaves:it,links:rt,copy:st,[Symbol.iterator]:ot};function ht(e,t){return e.parent===t.parent?1:2}function ce(e){var t=e.children;return t?t[0]:e.t}function ue(e){var t=e.children;return t?t[t.length-1]:e.t}function dt(e,t,r){var o=r/(t.i-e.i);t.c-=o,t.s+=r,e.c+=o,t.z+=r,t.m+=r}function mt(e){for(var t=0,r=0,o=e.children,u=o.length,m;--u>=0;)m=o[u],m.z+=t,m.m+=t,t+=m.s+(r+=m.c)}function ft(e,t,r){return e.a.parent===t.parent?e.a:r}function ie(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}ie.prototype=Object.create(J.prototype);function pt(e){for(var t=new ie(e,0),r,o=[t],u,m,h,j;r=o.pop();)if(m=r._.children)for(r.children=new Array(j=m.length),h=j-1;h>=0;--h)o.push(u=r.children[h]=new ie(m[h],h)),u.parent=r;return(t.parent=new ie(null,0)).children=[t],t}function gt(){var e=ht,t=1,r=1,o=null;function u(a){var z=pt(a);if(z.eachAfter(m),z.parent.m=-z.z,z.eachBefore(h),o)a.eachBefore(B);else{var _=a,d=a,C=a;a.eachBefore(function(T){T.x<_.x&&(_=T),T.x>d.x&&(d=T),T.depth>C.depth&&(C=T)});var E=_===d?1:e(_,d)/2,$=E-_.x,D=t/(d.x+E+$),y=r/(C.depth||1);a.eachBefore(function(T){T.x=(T.x+$)*D,T.y=T.depth*y})}return a}function m(a){var z=a.children,_=a.parent.children,d=a.i?_[a.i-1]:null;if(z){mt(a);var C=(z[0].z+z[z.length-1].z)/2;d?(a.z=d.z+e(a._,d._),a.m=a.z-C):a.z=C}else d&&(a.z=d.z+e(a._,d._));a.parent.A=j(a,d,a.parent.A||_[0])}function h(a){a._.x=a.z+a.parent.m,a.m+=a.parent.m}function j(a,z,_){if(z){for(var d=a,C=a,E=z,$=d.parent.children[0],D=d.m,y=C.m,T=E.m,w=$.m,N;E=ue(E),d=ce(d),E&&d;)$=ce($),C=ue(C),C.a=a,N=E.z+T-d.z-D+e(E._,d._),N>0&&(dt(ft(E,a,_),a,N),D+=N,y+=N),T+=E.m,D+=d.m,w+=$.m,y+=C.m;E&&!ue(C)&&(C.t=E,C.m+=T-y),d&&!ce($)&&($.t=d,$.m+=D-w,_=a)}return _}function B(a){a.x*=t,a.y=a.depth*r}return u.separation=function(a){return arguments.length?(e=a,u):e},u.size=function(a){return arguments.length?(o=!1,t=+a[0],r=+a[1],u):o?null:[t,r]},u.nodeSize=function(a){return arguments.length?(o=!0,t=+a[0],r=+a[1],u):o?[t,r]:null},u}const ne=e=>()=>e;function xt(e,{sourceEvent:t,target:r,transform:o,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:u}})}function he(e){e.stopImmediatePropagation()}function Z(e){e.preventDefault(),e.stopImmediatePropagation()}function yt(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function bt(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function _e(){return this.__zoom||ve}function _t(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function vt(){return navigator.maxTouchPoints||"ontouchstart"in this}function wt(e,t,r){var o=e.invertX(t[0][0])-r[0][0],u=e.invertX(t[1][0])-r[1][0],m=e.invertY(t[0][1])-r[0][1],h=e.invertY(t[1][1])-r[1][1];return e.translate(u>o?(o+u)/2:Math.min(0,o)||Math.max(0,u),h>m?(m+h)/2:Math.min(0,m)||Math.max(0,h))}function jt(){var e=yt,t=bt,r=wt,o=_t,u=vt,m=[0,1/0],h=[[-1/0,-1/0],[1/0,1/0]],j=250,B=Le,a=ke("start","zoom","end"),z,_,d,C=500,E=150,$=0,D=10;function y(i){i.property("__zoom",_e).on("wheel.zoom",Y,{passive:!1}).on("mousedown.zoom",F).on("dblclick.zoom",k).filter(u).on("touchstart.zoom",X).on("touchmove.zoom",G).on("touchend.zoom touchcancel.zoom",K).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(i,g,n,s){var c=i.selection?i.selection():i;c.property("__zoom",_e),i!==c?O(i,g,n,s):c.interrupt().each(function(){L(this,arguments).event(s).start().zoom(null,typeof g=="function"?g.apply(this,arguments):g).end()})},y.scaleBy=function(i,g,n,s){y.scaleTo(i,function(){var c=this.__zoom.k,x=typeof g=="function"?g.apply(this,arguments):g;return c*x},n,s)},y.scaleTo=function(i,g,n,s){y.transform(i,function(){var c=t.apply(this,arguments),x=this.__zoom,f=n==null?N(c):typeof n=="function"?n.apply(this,arguments):n,p=x.invert(f),b=typeof g=="function"?g.apply(this,arguments):g;return r(w(T(x,b),f,p),c,h)},n,s)},y.translateBy=function(i,g,n,s){y.transform(i,function(){return r(this.__zoom.translate(typeof g=="function"?g.apply(this,arguments):g,typeof n=="function"?n.apply(this,arguments):n),t.apply(this,arguments),h)},null,s)},y.translateTo=function(i,g,n,s,c){y.transform(i,function(){var x=t.apply(this,arguments),f=this.__zoom,p=s==null?N(x):typeof s=="function"?s.apply(this,arguments):s;return r(ve.translate(p[0],p[1]).scale(f.k).translate(typeof g=="function"?-g.apply(this,arguments):-g,typeof n=="function"?-n.apply(this,arguments):-n),x,h)},s,c)};function T(i,g){return g=Math.max(m[0],Math.min(m[1],g)),g===i.k?i:new re(g,i.x,i.y)}function w(i,g,n){var s=g[0]-n[0]*i.k,c=g[1]-n[1]*i.k;return s===i.x&&c===i.y?i:new re(i.k,s,c)}function N(i){return[(+i[0][0]+ +i[1][0])/2,(+i[0][1]+ +i[1][1])/2]}function O(i,g,n,s){i.on("start.zoom",function(){L(this,arguments).event(s).start()}).on("interrupt.zoom end.zoom",function(){L(this,arguments).event(s).end()}).tween("zoom",function(){var c=this,x=arguments,f=L(c,x).event(s),p=t.apply(c,x),b=n==null?N(p):typeof n=="function"?n.apply(c,x):n,S=Math.max(p[1][0]-p[0][0],p[1][1]-p[0][1]),v=c.__zoom,R=typeof g=="function"?g.apply(c,x):g,I=B(v.invert(b).concat(S/v.k),R.invert(b).concat(S/R.k));return function(M){if(M===1)M=R;else{var A=I(M),Q=S/A[2];M=new re(Q,b[0]-A[0]*Q,b[1]-A[1]*Q)}f.zoom(null,M)}})}function L(i,g,n){return!n&&i.__zooming||new V(i,g)}function V(i,g){this.that=i,this.args=g,this.active=0,this.sourceEvent=null,this.extent=t.apply(i,g),this.taps=0}V.prototype={event:function(i){return i&&(this.sourceEvent=i),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(i,g){return this.mouse&&i!=="mouse"&&(this.mouse[1]=g.invert(this.mouse[0])),this.touch0&&i!=="touch"&&(this.touch0[1]=g.invert(this.touch0[0])),this.touch1&&i!=="touch"&&(this.touch1[1]=g.invert(this.touch1[0])),this.that.__zoom=g,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(i){var g=H(this.that).datum();a.call(i,this.that,new xt(i,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:a}),g)}};function Y(i,...g){if(!e.apply(this,arguments))return;var n=L(this,g).event(i),s=this.__zoom,c=Math.max(m[0],Math.min(m[1],s.k*Math.pow(2,o.apply(this,arguments)))),x=q(i);if(n.wheel)(n.mouse[0][0]!==x[0]||n.mouse[0][1]!==x[1])&&(n.mouse[1]=s.invert(n.mouse[0]=x)),clearTimeout(n.wheel);else{if(s.k===c)return;n.mouse=[x,s.invert(x)],oe(this),n.start()}Z(i),n.wheel=setTimeout(f,E),n.zoom("mouse",r(w(T(s,c),n.mouse[0],n.mouse[1]),n.extent,h));function f(){n.wheel=null,n.end()}}function F(i,...g){if(d||!e.apply(this,arguments))return;var n=i.currentTarget,s=L(this,g,!0).event(i),c=H(i.view).on("mousemove.zoom",b,!0).on("mouseup.zoom",S,!0),x=q(i,n),f=i.clientX,p=i.clientY;Fe(i.view),he(i),s.mouse=[x,this.__zoom.invert(x)],oe(this),s.start();function b(v){if(Z(v),!s.moved){var R=v.clientX-f,I=v.clientY-p;s.moved=R*R+I*I>$}s.event(v).zoom("mouse",r(w(s.that.__zoom,s.mouse[0]=q(v,n),s.mouse[1]),s.extent,h))}function S(v){c.on("mousemove.zoom mouseup.zoom",null),Ve(v.view,s.moved),Z(v),s.event(v).end()}}function k(i,...g){if(e.apply(this,arguments)){var n=this.__zoom,s=q(i.changedTouches?i.changedTouches[0]:i,this),c=n.invert(s),x=n.k*(i.shiftKey?.5:2),f=r(w(T(n,x),s,c),t.apply(this,g),h);Z(i),j>0?H(this).transition().duration(j).call(O,f,s,i):H(this).call(y.transform,f,s,i)}}function X(i,...g){if(e.apply(this,arguments)){var n=i.touches,s=n.length,c=L(this,g,i.changedTouches.length===s).event(i),x,f,p,b;for(he(i),f=0;f<s;++f)p=n[f],b=q(p,this),b=[b,this.__zoom.invert(b),p.identifier],c.touch0?!c.touch1&&c.touch0[2]!==b[2]&&(c.touch1=b,c.taps=0):(c.touch0=b,x=!0,c.taps=1+!!z);z&&(z=clearTimeout(z)),x&&(c.taps<2&&(_=b[0],z=setTimeout(function(){z=null},C)),oe(this),c.start())}}function G(i,...g){if(this.__zooming){var n=L(this,g).event(i),s=i.changedTouches,c=s.length,x,f,p,b;for(Z(i),x=0;x<c;++x)f=s[x],p=q(f,this),n.touch0&&n.touch0[2]===f.identifier?n.touch0[0]=p:n.touch1&&n.touch1[2]===f.identifier&&(n.touch1[0]=p);if(f=n.that.__zoom,n.touch1){var S=n.touch0[0],v=n.touch0[1],R=n.touch1[0],I=n.touch1[1],M=(M=R[0]-S[0])*M+(M=R[1]-S[1])*M,A=(A=I[0]-v[0])*A+(A=I[1]-v[1])*A;f=T(f,Math.sqrt(M/A)),p=[(S[0]+R[0])/2,(S[1]+R[1])/2],b=[(v[0]+I[0])/2,(v[1]+I[1])/2]}else if(n.touch0)p=n.touch0[0],b=n.touch0[1];else return;n.zoom("touch",r(w(f,p,b),n.extent,h))}}function K(i,...g){if(this.__zooming){var n=L(this,g).event(i),s=i.changedTouches,c=s.length,x,f;for(he(i),d&&clearTimeout(d),d=setTimeout(function(){d=null},C),x=0;x<c;++x)f=s[x],n.touch0&&n.touch0[2]===f.identifier?delete n.touch0:n.touch1&&n.touch1[2]===f.identifier&&delete n.touch1;if(n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0)n.touch0[1]=this.__zoom.invert(n.touch0[0]);else if(n.end(),n.taps===2&&(f=q(f,this),Math.hypot(_[0]-f[0],_[1]-f[1])<D)){var p=H(this).on("dblclick.zoom");p&&p.apply(this,arguments)}}}return y.wheelDelta=function(i){return arguments.length?(o=typeof i=="function"?i:ne(+i),y):o},y.filter=function(i){return arguments.length?(e=typeof i=="function"?i:ne(!!i),y):e},y.touchable=function(i){return arguments.length?(u=typeof i=="function"?i:ne(!!i),y):u},y.extent=function(i){return arguments.length?(t=typeof i=="function"?i:ne([[+i[0][0],+i[0][1]],[+i[1][0],+i[1][1]]]),y):t},y.scaleExtent=function(i){return arguments.length?(m[0]=+i[0],m[1]=+i[1],y):[m[0],m[1]]},y.translateExtent=function(i){return arguments.length?(h[0][0]=+i[0][0],h[1][0]=+i[1][0],h[0][1]=+i[0][1],h[1][1]=+i[1][1],y):[[h[0][0],h[0][1]],[h[1][0],h[1][1]]]},y.constrain=function(i){return arguments.length?(r=i,y):r},y.duration=function(i){return arguments.length?(j=+i,y):j},y.interpolate=function(i){return arguments.length?(B=i,y):B},y.on=function(){var i=a.on.apply(a,arguments);return i===a?y:i},y.clickDistance=function(i){return arguments.length?($=(i=+i)*i,y):Math.sqrt($)},y.tapDistance=function(i){return arguments.length?(D=+i,y):D},y}const zt=({x:e,y:t,person:r,relation:o,onViewDetail:u})=>{const m=W.useRef(null),[h,j]=W.useState(!1);W.useEffect(()=>{const a=m.current;j(a&&a.scrollWidth>a.clientWidth)},[r]);const B=h?"text-xs":"text-sm";return l.jsx("foreignObject",{x:e,y:t,width:260,height:150,children:l.jsx("div",{className:`bg-white rounded-xl shadow-md border p-3 w-[240px] text-sm transition-all duration-200 hover:shadow-lg hover:border-2
        ${o==="Self"?"border-blue-400":"border-gray-300"}`,children:l.jsxs("div",{className:"flex items-start space-x-3",children:[l.jsx("img",{src:(r==null?void 0:r.resident_picture_path)==null?"/images/default-avatar.jpg":`/storage/${r.resident_picture_path}`,alt:`${r==null?void 0:r.firstname}'s photo`,className:"w-14 h-14 rounded-full object-cover border"}),l.jsxs("div",{className:"flex-1 space-y-1",children:[l.jsxs("p",{ref:m,className:`m-0 leading-tight font-medium whitespace-nowrap overflow-hidden ${B}`,children:[r==null?void 0:r.lastname,", ",r==null?void 0:r.firstname," ",r!=null&&r.middlename?r.middlename.charAt(0)+". ":"",(r==null?void 0:r.suffix)??""]}),l.jsx("h2",{className:"m-0 font-semibold text-gray-800",children:o}),l.jsxs("button",{onClick:()=>u({...r,relation:o}),className:"m-0 p-0 text-xs text-blue-500 hover:underline flex items-center space-x-1",children:[l.jsx(Te,{className:"text-base"}),l.jsx("span",{children:"View details"})]})]})]})})})};function Nt(e){var E,$,D,y,T;const t=(E=e.self)==null?void 0:E.data,r=(($=e.spouse)==null?void 0:$.data)||[],o=((D=e.siblings)==null?void 0:D.data)||[],u=((y=e.children)==null?void 0:y.data)||[],m=((T=e.parents)==null?void 0:T.data)||[],h={id:"virtual-root",relation:"Root",children:[]},j={...t,id:`person-${t==null?void 0:t.id}`,relation:"Self",children:[]},B=r.map(w=>({...w,id:`spouse-${w.id}`,relation:"Spouse",children:[]})),a=u.map(w=>({...w,id:`child-${w.id}`,relation:"Child",children:[]})),z=B.length>0?{...j,relation:"MainCouple",isCouple:!0,members:[j,...B],children:a}:{...j,children:a},_=o.filter(w=>w.id!==(t==null?void 0:t.id)).map(w=>({...w,id:`sibling-${w.id}`,relation:"Sibling",children:[]}));if(m.length===1){const w={...m[0],id:`parent-${m[0].id}`,relation:"Parent",children:[z,..._]};h.children=[w]}else if(m.length>=2){const w=m.slice(0,2).map(O=>({...O,id:`parent-${O.id}`,relation:"Parent",children:[]})),N={id:`parent-couple-${m.map(O=>O.id).join("-")}`,relation:"ParentCouple",isCouple:!0,members:w,children:[z,..._]};h.children=[N]}else h.children=[z,..._];const d=new Set;function C(w){w!=null&&w.children&&(w.children=w.children.filter(N=>d.has(N.id)?!1:(d.add(N.id),!0)),w.children.forEach(C))}return C(h),h}const P=240,U=90,St=({familyData:e})=>{console.log(e);const t=W.useRef(),[r,o]=W.useState([]),[u,m]=W.useState([]),[h,j]=W.useState(!1),[B,a]=W.useState(null),z=_=>{a(_),j(!0)};return W.useEffect(()=>{var G,K,i,g;const _=Nt(e),d=fe(_);gt().nodeSize([350,180])(d);const E=d.descendants(),$=Math.min(...E.map(n=>n.y)),D=Math.max(...E.map(n=>n.y)),y=600,T=1200,w=(y-(D-$))/2,N=[];d.descendants().forEach(n=>{var x;const s=n.x+T,c=n.y+w;if(n.data.isCouple&&((x=n.data.members)==null?void 0:x.length)>=1){const f=n.data.members,p=P+130;if(f.length===1)N.push({...f[0],x:s,y:c,relation:f[0].relation||"Relative",id:f[0].id});else{const b=f.find(v=>v.relation==="Self"),S=f.filter(v=>v.relation==="Spouse");if(b)N.push({...b,x:s,y:c,relation:"Self",id:b.id}),S.forEach((v,R)=>{const I=R%2===0?-1:1,M=Math.ceil((R+1)/2),A=s+I*p*M;N.push({...v,x:A,y:c,relation:"Spouse",id:v.id})});else{const v=Math.floor(f.length/2);f.forEach((R,I)=>{const M=(I-v)*p;N.push({...R,x:s+M,y:c,relation:R.relation||"Relative",id:R.id})})}}}else n.data.id!=="virtual-root"&&N.push({...n.data,x:s-P/2-65,y:c,relation:n.data.relation||"Relative",id:n.data.id})});const O=[...N],L=O.find(n=>n.relation==="Self"),V=O.find(n=>n.relation==="Spouse");if(L&&V&&((K=(G=e.siblings)==null?void 0:G.data)==null?void 0:K.length)>0){const n=O.filter(c=>c.y===L.y&&(c.relation==="Sibling"||c.relation==="Self"));n.sort((c,x)=>c.x-x.x);const s=n.findIndex(c=>c.id===L.id);if(s!==-1){const c=P*.8;for(let x=s+1;x<n.length;x++){const f=n[x],p=O.findIndex(b=>b.id===f.id);p!==-1&&(O[p].x+=c)}}}o(O);const Y=[];d.descendants().forEach(n=>{var s,c;if(n.data.isCouple&&((s=n.data.members)==null?void 0:s.length)>=1){const x=n.y+w,p=n.data.members.map(b=>N.find(S=>S.id===b.id)).filter(Boolean);for(let b=0;b<p.length-1;b++)Y.push({from:{x:p[b].x+P/2,y:p[b].y+U/2},to:{x:p[b+1].x+P/2,y:p[b+1].y+U/2}});if(((c=n.children)==null?void 0:c.length)>0){const b=n.children.map(M=>N.find(A=>A.id===M.data.id)).filter(Boolean);if(b.length===0)return;const S=p.map(M=>M.x+P/2),v=(Math.min(...S)+Math.max(...S))/2,R=x+U/2,I=R+90;if(b.length===1&&p.length===1){const M=b[0],A=M.x+P/2;Y.push({from:{x:v,y:R},to:{x:A,y:M.y}})}else if(b.length===1){const M=b[0],A=M.x+P/2;Y.push({from:{x:v,y:R},to:{x:v,y:I}}),Y.push({from:{x:v,y:I},to:{x:A,y:M.y}})}else{Y.push({from:{x:v,y:R},to:{x:v,y:I}});const M=b.map(ee=>ee.x+P/2),A=Math.min(...M),Q=Math.max(...M);Y.push({from:{x:A,y:I},to:{x:Q,y:I}}),b.forEach(ee=>{const pe=ee.x+P/2;Y.push({from:{x:pe,y:I},to:{x:pe,y:ee.y}})})}}}}),d.descendants().forEach(n=>{var s;if(!n.data.isCouple&&((s=n.children)==null?void 0:s.length)>0){const c=N.find(S=>S.id===n.data.id);if(!c)return;const x=c.x+P/2,f=c.y+U/2,p=f+90,b=n.children.map(S=>N.find(v=>v.id===S.data.id)).filter(Boolean);if(b.length===1){const S=b[0],v=S.x+P/2;Y.push({from:{x,y:f},to:{x:v,y:S.y}})}else if(b.length>1){Y.push({from:{x,y:f},to:{x,y:p}});const S=b.map(I=>I.x+P/2),v=Math.min(...S),R=Math.max(...S);Y.push({from:{x:v,y:p},to:{x:R,y:p}}),b.forEach(I=>{const M=I.x+P/2;Y.push({from:{x:M,y:p},to:{x:M,y:I.y}})})}}});const F=new Map;if(d.descendants().forEach(n=>{if(n.parent){const s=n.parent.data.id,c=N.some(f=>f.id===s);if(s==="virtual-root"||!c&&!n.parent.data.isCouple){F.has(s)||F.set(s,[]);const f=N.find(p=>p.id===n.data.id);f&&F.get(s).push(f)}}}),L&&((g=(i=e.siblings)==null?void 0:i.data)==null?void 0:g.length)>0){const n="virtual-root-self";F.has(n)||F.set(n,[]);const s=[L,...e.siblings.data.map(c=>N.find(x=>x.id===c.id)).filter(Boolean)];F.set(n,s)}F.forEach(n=>{if(n.length>1){n.sort((p,b)=>p.x-b.x);const s=n.map(p=>{var b;if(p.isCouple){const S=[];if((b=p.members)==null||b.forEach(v=>{const R=N.find(I=>I.id===v.id);R&&S.push(R)}),S.length>0){const v=Math.min(...S.map(A=>A.x)),R=Math.max(...S.map(A=>A.x)),I=(v+R+P)/2,M=S[0].y+U/2;return{...p,centerX:I,centerY:M}}}return{...p,centerX:p.x+P/2,centerY:p.y+U/2}}),c=s[0],x=s[s.length-1],f=c.centerY+5;Y.push({from:{x:c.centerX,y:f},to:{x:x.centerX,y:f}}),s.forEach(p=>{Y.push({from:{x:p.centerX,y:f},to:{x:p.centerX,y:p.centerY}})})}}),m(Y);const k=H(t.current),X=k.select("g");k.call(jt().scaleExtent([.3,2]).on("zoom",n=>{X.attr("transform",n.transform)}))},[e]),l.jsxs("div",{className:"w-[1170px] border rounded-lg bg-dot-grid",children:[l.jsx("div",{className:"overflow-auto max-h-[600px] max-w-full rounded-lg",children:l.jsx("svg",{ref:t,width:1200,height:1e3,viewBox:"0 0 2000 2000",className:"block",children:l.jsxs("g",{children:[u.map((_,d)=>l.jsx("line",{x1:_.from.x,y1:_.from.y,x2:_.to.x,y2:_.to.y,stroke:"#1E40AF",strokeWidth:2},`line-${d}`)),r.map((_,d)=>l.jsx(zt,{x:_.x,y:_.y,person:_,relation:_.relation,onViewDetail:z},`card-${d}`))]})})}),l.jsx(we,{isOpen:h,onClose:()=>j(!1),title:Re,children:l.jsx(Ee,{person:B})})]})};function pn({family_tree:e,residents:t}){var L,V,Y,F;const r=((Y=(V=(L=e==null?void 0:e.self)==null?void 0:L.data)==null?void 0:V.family)==null?void 0:Y.family_name)||"Unnamed",o=[{label:"Residents Information",showOnMobile:!1},{label:"Residents Table",href:route("resident.index"),showOnMobile:!1},{label:"Family Tree",showOnMobile:!0}],u=je().props,m=(u==null?void 0:u.success)??null,h=(u==null?void 0:u.error)??null,j=t.map(k=>({value:k.id,label:`${k.firstname} ${k.middlename} ${k.lastname} ${k.suffix??""}`,image:k.resident_picture_path||null,birthdate:k.birthdate||null,purok_number:k.purok_number||null})),[B,a]=W.useState(!1),z=((F=e==null?void 0:e.self)==null?void 0:F.data)||null,{data:_,setData:d,post:C,errors:E,reset:$,clearErrors:D}=ze({resident_id:null,related_to:null,relationship:"",family_relation_id:null,_method:void 0}),y=()=>{z&&d({resident_id:z.id,resident_id_name:`${z.firstname} ${z.middlename} ${z.lastname}`,resident_birthdate:z.birthdate,resident_image:z.resident_picture_path,resident_purok:z.purok_number,related_to:null,related_to_name:"",related_to_birthdate:null,related_to_image:null,related_to_purok:null,relationship:""}),a(!0)},T=k=>{k.preventDefault(),C(route("family_tree.store"),{onError:X=>{const G=Object.values(X).map((K,i)=>`<div key=${i}> ${K}</div>`);le.error("Validation Error",{description:l.jsx("div",{dangerouslySetInnerHTML:{__html:G.join("")}}),duration:4e3,closeButton:!0})}})},w=()=>{a(!1),$(),D()},N=(k,X)=>{X&&(d(`${k}`,X.value||X.id),d(`${k}_name`,X.label||`${X.firstname} ${X.middlename} ${X.lastname}`),d(`${k}_image`,X.image||null),d(`${k}_birthdate`,X.birthdate||null),d(`${k}_purok`,X.purok_number||null))},O=k=>{const X=j.find(G=>G.value==k);N("related_to",X)};return W.useEffect(()=>{m&&(w(),le.success(m,{description:"Operation successful!",duration:3e3,closeButton:!0})),u.success=null},[m]),W.useEffect(()=>{h&&(le.error(h,{description:"Operation failed!",duration:3e3,closeButton:!0}),w()),u.error=null},[h]),l.jsxs(Ie,{children:[l.jsx(Ne,{title:"Resident Dashboard"}),l.jsx(Se,{breadcrumbs:o}),l.jsx($e,{richColors:!0}),l.jsx(l.Fragment,{children:l.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[l.jsxs("div",{className:"overflow-hidden bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 my-8",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs("h2",{className:"text-xl font-bold mb-3",children:[r," Family Tree"]}),l.jsxs("div",{className:"relative group z-5 mr-4",children:[l.jsx(ye,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",onClick:y,children:l.jsx(Ae,{})}),l.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add A Relation"})]})]}),l.jsx("div",{className:"h-[600px] w-[1000px]",children:l.jsx(St,{familyData:e})})]}),l.jsxs(W.Suspense,{fallback:null,children:[" ",l.jsx(we,{isOpen:B,onClose:()=>w(),title:"Add a Relationship to the Tree",children:l.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:l.jsxs("form",{className:"space-y-8 bg-white p-6 rounded-xl shadow-md border border-gray-200",onSubmit:T,children:[l.jsxs("div",{className:"mb-6",children:[l.jsx("h3",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Add Family Relation"}),l.jsx("p",{className:"text-gray-600 text-sm",children:"Define the relationship between residents in the household. This helps maintain a proper family tree and household hierarchy."})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Resident Info"}),l.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Select the primary resident. Their basic details will auto-populate."}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 md:gap-x-6",children:[l.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[l.jsx(ae,{htmlFor:"resident_image",value:"Resident Profile"}),l.jsx("img",{src:_.resident_image?`/storage/${_.resident_image}`:"/images/default-avatar.jpg",alt:"Resident",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow-sm"})]}),l.jsxs("div",{className:"md:col-span-4 space-y-4",children:[l.jsx(ge,{label:"Resident",name:"resident_id_name",value:_.resident_id_name||"",placeholder:"Select a resident",items:j,onChange:k=>{const X=j.find(G=>G.id===k);X&&(d("resident_id",X.id),d("resident_id_name",X.name),d("resident_image",X.image),d("resident_birthdate",X.birthdate),d("resident_purok",X.purok_number))},disabled:!0}),l.jsx(se,{message:E.resident_id,className:"mt-1 text-sm text-red-500"}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[l.jsx(te,{label:"Birthdate",name:"resident_birthdate",value:_.resident_birthdate||"",readOnly:!0}),l.jsx(te,{label:"Purok Number",name:"resident_purok",value:_.resident_purok||"",readOnly:!0})]})]})]})]}),l.jsxs("div",{className:"space-y-4 mt-6",children:[l.jsx("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Related Resident Info"}),l.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Select the related resident and specify their relationship to the primary resident."}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 md:gap-x-6",children:[l.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[l.jsx(ae,{htmlFor:"related_to_image",value:"Related Resident Profile"}),l.jsx("img",{src:_.related_to_image?`/storage/${_.related_to_image}`:"/images/default-avatar.jpg",alt:"Related Resident",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow-sm"})]}),l.jsxs("div",{className:"md:col-span-4 space-y-4",children:[l.jsx(ge,{label:"Related To",name:"related_to_name",value:_.related_to_name||"",placeholder:"Select related resident",items:j,onChange:k=>{O(k.target.value)}}),l.jsx(se,{message:E.related_to,className:"mt-1 text-sm text-red-500"}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[l.jsx(te,{label:"Birthdate",name:"related_to_birthdate",value:_.related_to_birthdate||"",readOnly:!0}),l.jsx(te,{label:"Purok Number",name:"related_to_purok",value:_.related_to_purok||"",readOnly:!0})]})]})]})]}),l.jsxs("div",{className:"mt-6",children:[l.jsx(ae,{value:"Relationship Type"}),l.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"Select the type of relationship between the primary resident and the related resident."}),l.jsx(Ce,{label:"Relationship",name:"relationship",value:_.relationship,onChange:k=>d("relationship",k.target.value),placeholder:"Select relationship",items:[{label:"Spouse",value:"spouse",subtitle:"Legally married partner of the head"},{label:"Child",value:"child",subtitle:"Son or daughter of the head"},{label:"Sibling",value:"sibling",subtitle:"Brother or sister of the head"},{label:"Parent",value:"parent",subtitle:"Father or mother of the head"}]}),l.jsx(se,{message:E.relationship,className:"mt-1 text-sm text-red-500"})]}),l.jsx("div",{className:"flex justify-end mt-8",children:l.jsx(ye,{className:"bg-blue-700 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md transition-all duration-200 ease-in-out",type:"submit",children:"Add Relation"})})]})})})]})]})})]})}export{pn as default};
