import{K as pe,r as y,m as Q,j as e,L as xe,a as be,S as je}from"./app-CDPwVV6Y.js";import fe from"./BreadcrumbsHeader-BOSIhs5m.js";import{I as h}from"./InputError-CsvCol3W.js";import{I as p}from"./InputField-D_ZI8EKx.js";import{I as i}from"./InputLabel-C3y8TkvV.js";import{B as w}from"./button-B_aprJyo.js";import{S as ye}from"./AdminLayout-BW3ywimG.js";import{S as v}from"./SelectField-DIeNwIQe.js";import{T as k}from"./textarea-CVDV7Abf.js";import{P as M}from"./ParticipantSection-By2um38y.js";import{t as b,T as ve}from"./index-CH7DWExs.js";import{a as Ne,I as Se}from"./index-D4O4cOmu.js";import{u as we}from"./useAppUrl-BIsbUUVL.js";import ke from"./SidebarModal-CSWrtQJc.js";import _e from"./DeleteConfirmationModal-DcMwm5QA.js";import{R as Ce}from"./rotate-ccw-D-jj88si.js";import{c as De}from"./createLucideIcon-B4SoG9zf.js";import"./breadcrumb-DsnADmME.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./chevron-right-DYtVQaAj.js";import"./sidebar-BqlEtGlg.js";import"./input-DTbtaxsV.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./tooltip-10O7WS77.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./file-text-DhLfxzDZ.js";import"./users-round-BK2vts8v.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./DropdownInputField-BmM-TOT_.js";import"./constants-DHCt9dPc.js";import"./iconBase-DNpEM3Pe.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]],Re=De("calendar-check",Ae);function xs({residents:X,blotter_details:a}){var E,L,F,B,$,O,H,U,V,K,W,Y,q,z;const Z=[{label:"Katarungang Pambarangay",showOnMobile:!1},{label:"Blotter Reports",href:route("blotter_report.index"),showOnMobile:!1},{label:"Summons",href:route("summon.index"),showOnMobile:!1},{label:"Elevate to Summon",showOnMobile:!0}],ee=we(),g=pe().props,_=(g==null?void 0:g.success)??null,j=(g==null?void 0:g.error)??null,[se,C]=y.useState(!1),[ae,D]=y.useState(!1),[I,ne]=y.useState(null),A=(s,r)=>(s==null?void 0:s.filter(n=>n.role_type===r).map(n=>{var m,c,S,l,d;return{resident_id:n.resident_id||"",resident_name:n.name||n.display_name||"",birthdate:((m=n.resident)==null?void 0:m.birthdate)||"",sex:((c=n.resident)==null?void 0:c.sex)||"",purok_number:((S=n.resident)==null?void 0:S.purok_number)||"",email:((l=n.resident)==null?void 0:l.email)||"",contact_number:((d=n.resident)==null?void 0:d.contact_number)||"",notes:n.notes||""}}))||[{resident_id:""}],{data:o,setData:t,post:oe,errors:x,reset:P}=Q({type_of_incident:(a==null?void 0:a.type_of_incident)||"",narrative_details:(a==null?void 0:a.narrative_details)||"",actions_taken:(a==null?void 0:a.actions_taken)||"",report_status:(a==null?void 0:a.report_status)||"pending",location:(a==null?void 0:a.location)||"",resolution:(a==null?void 0:a.resolution)||"",recommendations:(a==null?void 0:a.recommendations)||"",incident_date:(a==null?void 0:a.incident_date)||"",recorded_by:(a==null?void 0:a.recorded_by)||null,complainants:A(a==null?void 0:a.participants,"complainant"),respondents:A(a==null?void 0:a.participants,"respondent"),witnesses:A(a==null?void 0:a.participants,"witness"),summons:(a==null?void 0:a.summons)||[],newSession:{session_number:"",hearing_date:"",session_status:"scheduled",session_remarks:""},summon_status:(E=a==null?void 0:a.summons)!=null&&E.length?a.summons[a.summons.length-1].status:"",summon_remarks:(L=a==null?void 0:a.summons)!=null&&L.length?a.summons[a.summons.length-1].remarks:"",blotter_id:a.id}),{data:u,setData:f,post:re,errors:N,reset:T}=Q({session_number:"",hearing_date:"",session_status:"scheduled",session_remarks:"",session_id:null,_method:"PUT"}),R=X.map(s=>({value:s.id,label:`${s.firstname} ${s.middlename?s.middlename+" ":""}${s.lastname}${s.suffix?", "+s.suffix:""}`,...s})),ie=s=>{s.preventDefault(),oe(route("summon.store"),{onError:r=>{console.error("Validation Errors:",r);const n=Object.values(r).map((m,c)=>`<div key=${c} class="mb-1">â€¢ ${m}</div>`);b.error("Validation Error",{description:e.jsx("div",{className:"text-sm text-red-700 space-y-1",dangerouslySetInnerHTML:{__html:n.join("")}}),duration:5e3,closeButton:!0})}})},te=(F=o.summons)==null?void 0:F.some(s=>{var r;return(r=s.takes)==null?void 0:r.some(n=>n.originallyScheduled||n.session_status==="scheduled")}),le=(B=o.summons)==null?void 0:B.some(s=>{var r;return(r=s.takes)==null?void 0:r.some(n=>(n.session_number??0)>=3)}),de=!te&&!le,me=async s=>{try{const n=(await be.get(`${ee}/summon/session/${s}`)).data.session;f({session_number:n.session_number||"",hearing_date:n.hearing_date||"",session_status:n.session_status||"scheduled",session_remarks:n.session_remarks||"",session_id:n.id}),C(!0)}catch(r){console.error("Error fetching summon session details:",r),b.error("Failed to fetch session details. Please try again.")}},ue=()=>{C(!1),setInfrastructureDetails(null),P(),clearErrors()},ce=s=>{s.preventDefault(),re(route("summon.update.details",u.session_id),u,{onSuccess:()=>{f("summons",[...o.summons,u]),T(),C(!1)},onError:r=>{console.error("Validation Errors:",r);const n=Object.values(r).join("<br />");b.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:n}}),duration:3e3,closeButton:!0})}})},ge=s=>{ne(s),D(!0)},he=()=>{je.delete(route("summon.delete.details",I),{onError:s=>{console.error("Validation Errors:",s);const r=Object.values(s).join("<br />");b.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:r}}),duration:3e3,closeButton:!0})}}),D(!1)};return y.useEffect(()=>{_&&b.success(_,{description:"Operation successful!",duration:3e3,closeButton:!0}),g.success=null},[_]),y.useEffect(()=>{j&&b.error(j,{description:"Operation failed!",duration:3e3,closeButton:!0}),g.error=null},[j]),e.jsxs(ye,{children:[e.jsx(xe,{title:"Resident Dashboard"}),e.jsx(ve,{richColors:!0}),e.jsx(fe,{breadcrumbs:Z}),e.jsx("div",{children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"overflow-hidden bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 my-8",children:[e.jsxs("div",{className:" my-2 p-5",children:[j&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:j}),e.jsx("div",{children:e.jsxs("form",{onSubmit:ie,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-blue-800 mb-2",children:o.summon_status==="closed"?"Summon Details (Closed)":(($=o.summons)==null?void 0:$.length)>0&&((H=(O=o.summons[0])==null?void 0:O.takes)==null?void 0:H.length)>0?"Update Summon Details":"Create Summon Schedule"}),e.jsx("p",{className:"text-sm text-gray-600",children:o.summon_status==="closed"?e.jsxs(e.Fragment,{children:["This summon has been"," ",e.jsx("span",{className:"font-semibold text-red-600",children:"closed"}),". You can review the blotter details, participants, and hearing history, but no new sessions can be scheduled."]}):((U=o.summons)==null?void 0:U.length)>0&&((K=(V=o.summons[0])==null?void 0:V.takes)==null?void 0:K.length)>0?e.jsxs(e.Fragment,{children:["You can"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:"update summon details"})," ","for this blotter report. Review past sessions, adjust status or remarks, and make necessary updates to the summon information."]}):e.jsxs(e.Fragment,{children:["This form allows you to create a"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:"summon"})," ","for the selected"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:"blotter report"}),". Review the blotter details, update fields like"," ",e.jsx("span",{className:"font-semibold",children:"actions taken"}),","," ",e.jsx("span",{className:"font-semibold",children:"recommendations"}),", status, and participants, and schedule the new hearing session."]})})]}),e.jsxs("div",{className:"mb-6 p-6 bg-blue-50 border-l-4 border-blue-400 rounded-xl shadow-sm space-y-4",children:[e.jsx("h3",{className:"text-2xl font-semibold text-blue-700 mb-2",children:"Blotter Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Type of Incident"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:o.type_of_incident})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Incident Date"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:o.incident_date})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Location"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:o.location})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 lg:col-span-4",children:[e.jsx(i,{value:"Narrative Details"}),e.jsx("p",{className:"whitespace-pre-line text-gray-800 font-medium",children:o.narrative_details})]})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Actions Taken"}),e.jsx(k,{value:o.actions_taken||"",onChange:s=>t("actions_taken",s.target.value),placeholder:"What actions were taken?",rows:3,className:"border-blue-300 focus:ring-blue-400 focus:border-blue-400"}),e.jsx(h,{message:x.actions_taken,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Recommendations"}),e.jsx(k,{value:o.recommendations||"",onChange:s=>t("recommendations",s.target.value),placeholder:"Any recommendations?",rows:3,className:"border-blue-300 focus:ring-blue-400 focus:border-blue-400"}),e.jsx(h,{message:x.recommendations,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(v,{label:"Report Status",value:o.report_status||"",onChange:s=>t("report_status",s.target.value),items:[{label:"Pending",value:"pending"},{label:"On Going",value:"on_going"},{label:"Resolved",value:"resolved"},{label:"Elevated",value:"elevated"}],className:"font-semibold text-gray-800"}),e.jsx(h,{message:x.report_status,className:"mt-1"})]}),e.jsx("div",{children:e.jsx(v,{value:o.summon_status||"",label:"Summon Status",onChange:s=>t("summon_status",s.target.value),items:[{label:"Arbitration",value:"arbitration"},{label:"Medication",value:"medication"},{label:"Conciliation",value:"conciliation"},{label:"Issued Certificate to File Action",value:"issued_file_to_action"},{label:"Closed",value:"closed"}],placeholder:"Select Summon Status",className:"font-semibold text-gray-800"})})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Summon Remarks"}),e.jsx(k,{value:o.summon_remarks||"",onChange:s=>t("summon_remarks",s.target.value),placeholder:"Enter summon remarks",rows:3,className:"mb-4 border-blue-300 focus:ring-blue-400 focus:border-blue-400"}),e.jsx(h,{message:x.summon_remarks,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{title:"Complainants",dataArray:o.complainants,setDataArray:s=>t("complainants",s),errors:x,residentsList:R,className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg",disableAdd:o.summon_status=="closed"}),e.jsx(M,{title:"Respondents",dataArray:o.respondents,setDataArray:s=>t("respondents",s),errors:x,residentsList:R,className:"bg-red-50 border-l-4 border-red-400 p-4 rounded-lg",disableAdd:o.summon_status=="closed"}),e.jsx(M,{title:"Witnesses",dataArray:o.witnesses,setDataArray:s=>t("witnesses",s),errors:x,residentsList:R,className:"bg-green-50 border-l-4 border-green-400 p-4 rounded-lg",disableAdd:o.summon_status=="closed"})]}),o.summons&&o.summons.length>0&&e.jsxs("div",{className:"mt-8 p-6 bg-gray-50 border-l-4 border-gray-400 rounded-xl space-y-4 shadow-sm",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-700 mb-4",children:"Previous Summon Sessions"}),o.summons.map((s,r)=>e.jsx("div",{className:"space-y-3",children:s.takes.map((n,m)=>{n.originallyScheduled===void 0&&(n.originallyScheduled=n.session_status==="scheduled");const c=n.originallyScheduled,S=r===o.summons.length-1&&m===s.takes.length-1;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3 p-4 bg-white rounded-lg shadow relative",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Session #"}),c?e.jsx(p,{type:"number",value:n.session_number||"",onChange:l=>{const d=[...o.summons];d[r].takes[m].session_number=l.target.value,t("summons",d)},className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 font-semibold rounded"}):e.jsx("p",{className:"text-gray-900 font-semibold",children:n.session_number})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Hearing Date"}),c?e.jsx(p,{type:"date",value:n.hearing_date||"",onChange:l=>{const d=[...o.summons];d[r].takes[m].hearing_date=l.target.value,t("summons",d)},className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 font-semibold rounded"}):e.jsx("p",{className:"text-gray-900 font-semibold",children:n.hearing_date})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Status"}),c?e.jsx(v,{value:n.session_status||"scheduled",onChange:l=>{var J;const d=((J=l==null?void 0:l.target)==null?void 0:J.value)??l,G=[...o.summons];G[r].takes[m].session_status=d,t("summons",G)},items:[{label:"Scheduled",value:"scheduled"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Adjourned",value:"adjourned"},{label:"Cancelled",value:"cancelled"},{label:"No Show",value:"no_show"}],className:"font-semibold text-gray-800 rounded"}):e.jsx("p",{className:"capitalize text-gray-900 font-semibold",children:n.session_status})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Remarks"}),c?e.jsx(p,{value:n.session_remarks||"",onChange:l=>{const d=[...o.summons];d[r].takes[m].session_remarks=l.target.value,t("summons",d)},placeholder:"Optional remarks",className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 font-medium rounded"}):e.jsx("p",{className:"text-gray-900 font-medium",children:n.session_remarks||"-"})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>me(n.id),className:"flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-600 rounded-md text-sm font-medium hover:bg-blue-100 hover:text-blue-700 transition",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Edit"]}),S&&e.jsxs("button",{type:"button",onClick:()=>ge(n.id),className:"flex items-center gap-1 px-2 py-1 bg-red-50 text-red-600 rounded-md text-sm font-medium hover:bg-red-100 hover:text-red-700 transition",children:[e.jsx(Se,{className:"w-4 h-4"}),"Delete"]})]})]},m)})},r))]}),o.summon_status!=="closed"&&de&&e.jsxs("div",{className:"mt-8 p-6 bg-gray-50 border-l-4 border-blue-600 rounded-xl space-y-4 shadow-sm",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-700 mb-4",children:"New Summon Session"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Session #"}),e.jsx(p,{type:"number",value:((W=o.newSession)==null?void 0:W.session_number)||"",onChange:s=>t("newSession",{...o.newSession,session_number:s.target.value}),className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 rounded-lg p-2 w-full font-semibold text-gray-800"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Hearing Date"}),e.jsx(p,{type:"date",value:((Y=o.newSession)==null?void 0:Y.hearing_date)||"",onChange:s=>t("newSession",{...o.newSession,hearing_date:s.target.value}),className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 rounded-lg p-2 w-full font-semibold text-gray-800"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Session Status"}),e.jsx(v,{value:((q=o.newSession)==null?void 0:q.session_status)||"scheduled",onChange:s=>{var n;const r=((n=s==null?void 0:s.target)==null?void 0:n.value)??s;t("newSession",{...o.newSession,session_status:r})},items:[{label:"Scheduled",value:"scheduled"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Adjourned",value:"adjourned"},{label:"Cancelled",value:"cancelled"},{label:"No Show",value:"no_show"}],className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 rounded-lg p-2 w-full font-semibold text-gray-800"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Remarks"}),e.jsx(p,{value:((z=o.newSession)==null?void 0:z.session_remarks)||"",onChange:s=>t("newSession",{...o.newSession,session_remarks:s.target.value}),placeholder:"Optional remarks",className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 rounded-lg p-2 w-full font-medium text-gray-700"})]})]})]}),e.jsxs("div",{className:"flex w-full justify-end items-center mt-7 gap-4",children:[e.jsxs(w,{type:"button",onClick:()=>P(),className:"bg-gray-200 hover:bg-gray-300 text-gray-800",children:[e.jsx(Ce,{})," Reset"]}),e.jsxs(w,{type:"submit",className:`w-60 ${o.summon_status==="closed"?"bg-red-700 hover:bg-red-600":"bg-blue-700 hover:bg-blue-600"} text-white`,children:[e.jsx(Re,{className:"w-4 h-4 mr-1"}),o.summon_status==="closed"?"Update Summon Details":"Create Summon Schedule"]})]})]})})]}),e.jsx(ke,{isOpen:se,onClose:()=>{ue()},title:"Edit Summon Session",children:e.jsxs("form",{className:"bg-gray-50 p-6 rounded-xl shadow-md border border-gray-200",onSubmit:ce,children:[e.jsx("h3",{className:"text-3xl font-semibold text-gray-800 mb-2",children:u.session_id?"Edit Summon Session":"New Summon Session"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-sm",children:["Please provide the details for this summon session. Fields marked below are required.",e.jsx("span",{className:"block mt-1 text-gray-400 text-xs",children:"Session number cannot be changed once created."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-5",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"session_number",value:"Session #"}),e.jsx(p,{id:"session_number",type:"number",value:u.session_number,disabled:!0,placeholder:"Session number (auto-assigned)",className:"w-full rounded-lg border-gray-300 shadow-sm bg-gray-100 cursor-not-allowed text-gray-600 focus:ring focus:ring-indigo-200 focus:border-indigo-500"}),e.jsx(h,{message:N.session_number,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"hearing_date",value:"Hearing Date"}),e.jsx(p,{id:"hearing_date",type:"date",value:u.hearing_date,onChange:s=>f("hearing_date",s.target.value),className:"w-full rounded-lg border-gray-300 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500"}),e.jsx(h,{message:N.hearing_date,className:"mt-1"})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx(i,{value:"Session Status"}),e.jsx(v,{value:u.session_status,onChange:s=>{var n;const r=((n=s==null?void 0:s.target)==null?void 0:n.value)??s;f("session_status",r)},items:[{label:"Scheduled",value:"scheduled"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Adjourned",value:"adjourned"},{label:"Cancelled",value:"cancelled"},{label:"No Show",value:"no_show"}],className:"w-full rounded-lg border-gray-300 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500"}),e.jsx(h,{message:N.session_status,className:"mt-1"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(i,{value:"Remarks / Notes"}),e.jsx(k,{value:u.session_remarks,onChange:s=>f("session_remarks",s.target.value),placeholder:"Optional notes about the session, e.g., agenda or discussion points.",className:"w-full rounded-lg border-gray-300 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500 text-sm",rows:4}),e.jsx(h,{message:N.session_remarks,className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx(w,{type:"button",onClick:()=>T(),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg shadow-sm",children:"Reset"}),e.jsxs(w,{type:"submit",className:"bg-blue-700 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md",children:[u.session_id?"Update":"Add"," ","Session"]})]})]})}),e.jsx(_e,{isOpen:ae,onClose:()=>D(!1),onConfirm:he,residentId:I})]})})})]})}export{xs as default};
