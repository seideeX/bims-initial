import{r as i,K as ie,m as ne,j as e,L as oe,S as F,$ as re,a as le}from"./app-CDPwVV6Y.js";import ce from"./DynamicTable-C_SQJSlc.js";import{S as de}from"./AdminLayout-BW3ywimG.js";import{u as me}from"./useAppUrl-BIsbUUVL.js";import ue from"./ActionMenu-CazUS606.js";import pe from"./DynamicTableControls-CcWMFg7f.js";import{I as xe}from"./input-DTbtaxsV.js";import{B as g}from"./button-B_aprJyo.js";import he from"./FillterToggle-cYp57TD0.js";import{I as be,a as ge}from"./constants-DHCt9dPc.js";import{I as fe}from"./InputField-D_ZI8EKx.js";import{I as p}from"./InputError-CsvCol3W.js";import{D as je}from"./DropdownInputField-BmM-TOT_.js";import{Y as ye}from"./YearDropdown-Cu5CjLYl.js";import{I as ve,a as Ne,b as Se}from"./index-D4O4cOmu.js";import Ie from"./SidebarModal-CSWrtQJc.js";import{T as _e}from"./textarea-CVDV7Abf.js";import{t as l,T as we}from"./index-CH7DWExs.js";import{S as Ce}from"./SelectField-DIeNwIQe.js";import Te from"./DeleteConfirmationModal-DcMwm5QA.js";import Ee from"./BreadcrumbsHeader-BOSIhs5m.js";import{U as De}from"./users-round-BK2vts8v.js";import{S as Oe}from"./search-BLeXCASV.js";import{L as ke}from"./list-plus-D4__nvo2.js";import{R as Ae}from"./rotate-ccw-D-jj88si.js";import{S as Fe}from"./square-pen-7JDEATcf.js";import{T as Me}from"./trash-2-DGe7ZjJ3.js";import"./createLucideIcon-B4SoG9zf.js";import"./sidebar-BqlEtGlg.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-8Tef56KC.js";import"./index-Dsz93ONd.js";import"./floating-ui.react-dom-VvtSZ_DO.js";import"./x-rg4AgZHH.js";import"./tooltip-10O7WS77.js";import"./nav-user-BTW7oy-u.js";import"./avatar-p9YAZDXV.js";import"./dropdown-menu-DFrz86N0.js";import"./check-BsJSkZwI.js";import"./chevron-right-DYtVQaAj.js";import"./file-text-DhLfxzDZ.js";import"./heart-pulse-BRIexC2Z.js";import"./chevron-up-BBBA9wsx.js";import"./ellipsis-pjh7Fz_j.js";import"./react-datepicker-BTgyaUwu.js";import"./index-BntGPR1O.js";import"./iconBase-DNpEM3Pe.js";import"./breadcrumb-DsnADmME.js";const Ot=({institutions:M,institutionNames:$,queryParams:n})=>{const B=[{label:"Barangay Resources",showOnMobile:!1},{label:"Insititutions",showOnMobile:!0}],R=me();n=n||{};const[U,f]=i.useState(!1),[Y,j]=i.useState(""),[c,C]=i.useState(null),[T,L]=i.useState(n.name??""),[V,y]=i.useState(!1),[E,z]=i.useState(null),o=ie().props,v=(o==null?void 0:o.success)??null,N=(o==null?void 0:o.error)??null,S=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"type",label:"Institution Type"},{key:"head",label:"Head of Institution"},{key:"description",label:"Description"},{key:"year_established",label:"Year Established"},{key:"status",label:"Status"},{key:"actions",label:"Actions"}],H=S.map(t=>t.key),[x,G]=i.useState(()=>{const t=localStorage.getItem("instutions_visible_columns");return t?JSON.parse(t):H});i.useEffect(()=>{localStorage.setItem("instutions_visible_columns",JSON.stringify(x))},[x]);const I=Object.entries(n||{}).some(([t,s])=>["institution"].includes(t)&&s&&s!=="");i.useEffect(()=>{I&&D(!0)},[I]);const[_,D]=i.useState(I),K=t=>{t.preventDefault(),w("name",T)},w=(t,s)=>{s&&s.trim()!==""?n[t]=s:delete n[t],n.page&&delete n.page,F.get(route("barangay_institution.index",n))},J=(t,s)=>{s.key==="Enter"&&w(t,s.target.value)},X={id:t=>t.id,name:t=>e.jsx(re,{href:route("barangay_institution.show",t.id),children:e.jsx("span",{className:"font-medium text-gray-900 hover:text-blue-500 hover:underline",children:t.name||"—"})}),type:t=>e.jsx("span",{className:"text-sm text-gray-700",children:ge[t.type]||"—"}),head:t=>{var r;const s=(r=t==null?void 0:t.head)==null?void 0:r.resident;if(!s)return"No assigned head";const a=`${s.firstname} ${s.middlename??""} ${s.lastname} ${s.suffix??""}`.trim(),b=s.contact_number?s.contact_number:"No contact";return e.jsxs("div",{className:"flex flex-col text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900",children:a}),e.jsx("span",{className:"text-gray-500",children:b})]})},description:t=>e.jsx("span",{className:"text-sm text-gray-500 line-clamp-2",children:t.description||"—"}),year_established:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.year_established||"—"}),status:t=>{const s={active:"bg-green-100 text-green-800",inactive:"bg-yellow-100 text-yellow-800",dissolved:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${s[t.status]||"bg-gray-100 text-gray-800"}`,children:be[t.status]||"—"})},actions:t=>e.jsx(ue,{actions:[{label:"Edit",icon:e.jsx(Fe,{className:"w-4 h-4 text-green-500"}),onClick:()=>ee(t.id)},{label:"Delete",icon:e.jsx(Me,{className:"w-4 h-4 text-red-600"}),onClick:()=>se(t.id)}]})},Q=()=>{j("add"),f(!0)},{data:d,setData:h,post:O,errors:m,reset:k,clearErrors:W}=ne({institutions:[[]],_method:void 0,institution_id:null}),Z=()=>{h("institutions",[...d.institutions||[],{}])},P=t=>{const s=[...d.institutions||[]];s.splice(t,1),h("institutions",s),l.warning("Institution removed.",{duration:2e3})},A=()=>{f(!1),j(""),C(null),k(),W()},u=(t,s,a)=>{h(b=>{const r=[...b.institutions];return r[s]||(r[s]={}),r[s]={...r[s],[a]:t},{...b,institutions:r}})},q=t=>{t.preventDefault(),O(route("barangay_institution.store"),{onError:s=>{console.error("Validation Errors:",s);const a=Object.values(s).join("<br />");l.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}})},ee=async t=>{j("edit");try{const a=(await le.get(`${R}/barangay_institution/details/${t}`)).data.institution;console.log(a),C(a),h({institutions:[{name:a.name||"",type:a.type||"",status:a.status||"",description:a.description||"",year_established:a.year_established||""}],_method:"PUT",institution_id:a.id}),f(!0)}catch(s){console.error("Error fetching institution details:",s)}},te=t=>{t.preventDefault(),O(route("barangay_institution.update",d.institution_id),{onError:s=>{const a=Object.values(s).join("<br />");l.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}})},se=t=>{z(t),y(!0)},ae=()=>{F.delete(route("barangay_institution.destroy",E),{onError:t=>{console.error("Validation Errors:",t);const s=Object.values(t).join("<br />");l.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})}}),y(!1)};return i.useEffect(()=>{v&&(A(),l.success(v,{description:"Operation successful!",duration:3e3,closeButton:!0})),o.success=null},[v]),i.useEffect(()=>{N&&l.error(N,{description:"Operation failed!",duration:3e3,closeButton:!0}),o.error=null},[N]),e.jsxs(de,{children:[e.jsx(oe,{title:"Barangay Infrastructure"}),e.jsx(Ee,{breadcrumbs:B}),e.jsx(we,{richColors:!0}),e.jsxs("div",{className:"pt-4 mb-10",children:[e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(De,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Barangay Institution Overview"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review, filter, and manage existing barangay institutions efficiently."})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(pe,{allColumns:S,visibleColumns:x,setVisibleColumns:G,showFilters:_,toggleShowFilters:()=>D(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:K,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(xe,{type:"text",placeholder:"Search institutions",value:T,onChange:t=>L(t.target.value),onKeyDown:t=>J("name",t.target.value),className:"ml-4"}),e.jsx(g,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Oe,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(g,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:Q,children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add an Institution"})]})]})]}),_&&e.jsx(he,{queryParams:n,searchFieldName:w,visibleFilters:["institution"],institutions:$,clearRouteName:"barangay_institution.index",clearRouteParams:{},showFilters:_}),e.jsx(ce,{queryParams:n,passedData:M,allColumns:S,columnRenderers:X,visibleColumns:x,showTotal:!0})]})]})}),e.jsx(Ie,{isOpen:U,onClose:()=>{A()},title:Y=="add"?"Add Institution":"Edit Institution",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:c?te:q,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Institutions / Groups"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about existing institutions, organizations, or groups within the barangay."}),Array.isArray(d.institutions)&&d.institutions.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(fe,{label:"Institution Name",name:"name",value:t.name||"",onChange:a=>u(a.target.value,s,"name"),placeholder:"e.g. Fisherfolk Association"}),e.jsx(p,{message:m[`institutions.${s}.name`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(je,{label:"Institution Type",name:"type",value:t.type||"",onChange:a=>u(a.target.value,s,"type"),placeholder:"Select or enter type",items:[{label:"Youth Organization",value:"youth_org"},{label:"Cooperative",value:"coop"},{label:"Religious Group",value:"religious"},{label:"Farmers Association",value:"farmers"},{label:"Transport Group",value:"transport"}]}),e.jsx(p,{message:m[`institutions.${s}.type`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx(_e,{label:"Description",name:"description",value:t.description||"",onChange:a=>u(a.target.value,s,"description"),className:"text-gray-600",placeholder:"Brief description of the institution..."}),e.jsx(p,{message:m[`institutions.${s}.description`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(ye,{label:"Year Established",name:"year_established",value:t.year_established||"",onChange:a=>u(a.target.value,s,"year_established"),placeholder:"YYYY"}),e.jsx(p,{message:m[`institutions.${s}.year_established`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(Ce,{label:"Status",name:"status",value:t.status||"",onChange:a=>u(a.target.value,s,"status"),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Dissolved",value:"dissolved"}]}),e.jsx(p,{message:m[`institutions.${s}.status`],className:"mt-1"})]})]}),c===null&&e.jsx("button",{type:"button",onClick:()=>P(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(ve,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[c===null?e.jsxs("button",{type:"button",onClick:Z,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Ne,{className:"text-2xl"}),e.jsx("span",{children:"Add Institution"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[c==null&&e.jsxs(g,{type:"button",onClick:()=>k(),children:[e.jsx(Ae,{})," Reset"]}),e.jsxs(g,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[c?"Update":"Add"," ",e.jsx(Se,{})]})]})]})]})}),e.jsx(Te,{isOpen:V,onClose:()=>{y(!1)},onConfirm:ae,residentId:E})]})]})};export{Ot as default};
