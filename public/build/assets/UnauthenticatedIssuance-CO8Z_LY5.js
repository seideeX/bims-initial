import{r as $,m as F,j as e,L as U,a as C}from"./app-CDPwVV6Y.js";import{H as A}from"./Header-CLGsw4rs.js";import{u as T}from"./useAppUrl-BIsbUUVL.js";import{t as m}from"./index-CH7DWExs.js";import{I as p}from"./InputField-D_ZI8EKx.js";import{I as o}from"./InputError-CsvCol3W.js";import{D as u}from"./DropdownInputField-BmM-TOT_.js";import{B as S}from"./button-B_aprJyo.js";import{R as k}from"./rotate-ccw-D-jj88si.js";import"./index-BvB2ajn5.js";import"./iconBase-DNpEM3Pe.js";import"./chevron-right-DYtVQaAj.js";import"./createLucideIcon-B4SoG9zf.js";import"./index-Dsz93ONd.js";import"./clsx-B-dksMZM.js";import"./utils-CkmPJWYF.js";function se({auth:q,barangays:x=[]}){var v,N,w;const g=["fullname_2","civil_status_2","purpose_2","day_2","month_2","year_2","issued_on","day","month","year"],h=T(),[c,d]=$.useState([]),{data:t,setData:i,post:P,processing:b,errors:l,reset:y,clearErrors:E}=F({barangay_name:"",barangay_id:null,document_id:null,document_name:"",purpose:"",placeholders:null}),f=(t.placeholders||[]).some(a=>a.endsWith("_2")),R=async a=>{const r=x.find(s=>s.id.toString()===a);if(r){i({...t,barangay_id:r.id,barangay_name:r.barangay_name,document_name:""});try{const s=await C.get(`${h}/request-certificate-documents/${r.id}`);d(s.data.documents.map(n=>({label:n.name.replace(/\s+/g," ").trim(),value:n.id.toString()})))}catch(s){console.error("Error fetching documents:",s),d([])}}else i({...t,barangay_id:"",barangay_name:"",document_name:""}),d([])},j=a=>a.toLowerCase().replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),B=async a=>{const r=c.find(s=>s.value==a);if(r){i("document_name",r.label),i("document_id",r.value);try{const s=await C.get(`${h}/request-certificate-placeholders/${a}`);i("placeholders",s.data.placeholders)}catch(s){console.error("Error fetching placeholders:",s)}}},_=x.map(a=>({label:a.barangay_name,value:a.id.toString()})),I=a=>{a.preventDefault(),E();const r={};if(t.barangay_id||(r.barangay_id="Please select a barangay."),t.document_id||(r.document_id="Please select a certificate."),(!t.purpose||t.purpose.trim()==="")&&(r.purpose="Purpose is required."),(t.placeholders||[]).filter(s=>!g.includes(s)).forEach(s=>{(!t[s]||t[s].trim()==="")&&(r[s]=`${s.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())} is required.`)}),Object.keys(r).length>0){setError(r),m.error("Validation failed",{description:"Please fill in all required fields.",duration:4e3,className:"bg-red-100 text-red-800"});return}P(route("request.storerequest"),t,{preserveScroll:!0,onSuccess:()=>{m.success("Certificate request submitted successfully!",{duration:4e3,className:"bg-green-100 text-green-800"}),y()},onError:s=>{const n=Object.values(s).flat();m.error("Validation Error",{description:e.jsx("ul",{className:"list-disc pl-5",children:n.map((D,L)=>e.jsx("li",{children:D},L))}),duration:5e3})}})};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Request Certificate"}),e.jsx(A,{auth:q}),e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-10",children:e.jsxs("form",{onSubmit:I,className:"bg-white shadow-xl rounded-2xl p-8 my-10 space-y-10 border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Certificate & Barangay Selection"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Choose the type of certificate to issue and select the barangay for which it will be generated."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(u,{label:"Select a Barangay",items:_,value:((v=t.barangay_id)==null?void 0:v.toString())||"",onChange:a=>R(a.target.value)}),e.jsx(o,{message:l.barangay_name,className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"The barangay for which this certificate will be issued."})]}),e.jsxs("div",{children:[e.jsx(u,{label:"Select a Certificate",items:c,value:((N=t.document_id)==null?void 0:N.toString())||"",onChange:a=>B(a.target.value),disabled:!t.barangay_id||c.length===0}),e.jsx(o,{message:l.document_id,className:"mt-1"}),t.barangay_id?c.length>0?e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Example: Certificate of Indigency, Residency, etc."}):e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"No certificates available for this barangay."}):e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Please select a barangay first."})]}),f&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(u,{label:"Select Second Barangay",items:_,value:t.barangay_name_2,onChange:a=>i("barangay_name_2",a.target.value)}),e.jsx(o,{message:l.barangay_name_2,className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Some certificates require two barangays (e.g., shared jurisdiction or inter-barangay projects)."})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Purpose"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Provide the purpose of the certificate. This will appear in the certification document."}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx(p,{label:"Purpose",value:t.purpose,onChange:a=>i("purpose",a.target.value)}),e.jsx(o,{message:l.purpose,className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Example: Inter-barangay coordination, project request, collaboration, etc."})]}),f&&e.jsxs("div",{children:[e.jsx(p,{label:"Purpose (Second Barangay)",value:t.purpose_2,onChange:a=>i("purpose_2",a.target.value)}),e.jsx(o,{message:l.purpose_2,className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Provide a separate purpose if the second barangay requires one."})]})]})]}),((w=t.placeholders)==null?void 0:w.length)>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Additional Information"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Some templates require extra details. Fill out the fields below if they are present in the template."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.placeholders.filter(a=>!g.includes(a)).map((a,r)=>e.jsxs("div",{children:[e.jsx(p,{label:j(a),value:t[a]||"",onChange:s=>i(a,s.target.value)}),e.jsx(o,{message:l[a],className:"mt-1"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Provide information for"," ",e.jsx("span",{className:"font-medium",children:j(a)}),"."]})]},r))})]}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-6",children:[e.jsxs(S,{type:"button",onClick:()=>y(),variant:"outline",className:"flex items-center gap-2 text-gray-500",children:[e.jsx(k,{className:"w-4 h-4"})," Reset"]}),e.jsx(S,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl shadow-md",disabled:b||!t.barangay_id||!t.document_id||c.length===0,children:b?"Requesting...":"Request Certificate"})]})]})})]})}export{se as default};
